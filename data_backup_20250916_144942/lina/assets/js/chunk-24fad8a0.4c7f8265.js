(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-24fad8a0"],{6306:function(e,t,r){},c97f:function(e,t,r){"use strict";r("6306")},eb82:function(e,t,r){"use strict";r.r(t);var s=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[e.loading?e._e():r("GenericCreateUpdatePage",e._g(e._b({staticClass:"user-create-update",on:{getObjectDone:e.afterGetUser}},"GenericCreateUpdatePage",e.$data,!1),e.$listeners))],1)},a=[],n=(r("1c01"),r("58b2"),r("8e6e"),r("ac6a"),r("456d"),r("7f7f"),r("d25f"),r("f3e2"),r("96cf"),r("3b8d")),i=r("bd86"),o=(r("57e7"),r("6d67"),r("4360")),l=r("2f62"),u=r("2af9"),d=r("cd4a"),c=r("f823"),p=r("5cba"),f=r("387d");function m(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,s)}return r}function h(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?m(Object(r),!0).forEach((function(t){Object(i["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):m(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var g={components:{GenericCreateUpdatePage:d["c"]},data:function(){var e=this,t=this.$createElement,r=this.$t("RoleManage");return{loading:!0,initial:{need_update_password:!0,system_roles:[],org_roles:[]},user:{can_public_key_auth:!1},fields:[[this.$t("Basic"),["name","username","email","groups"]],[this.$t("Authentication"),["password_strategy","update_password","password","need_update_password","mfa_level","source"]],[this.$t("Secure"),["system_roles","org_roles","is_active","date_expired"]],[this.$t("Other"),["phone","comment"]]],url:"/api/v1/users/users/",fieldsMeta:{name:{},username:{},password_strategy:{hidden:function(t){return e.$route.params.id||"local"!==t.source}},mfa_level:{disabled:!1},email:{rules:[p["f"].EmailCheck,p["f"].Required]},update_password:{label:this.$t("ChangePassword"),type:"checkbox",hidden:function(t){return!!t.update_password||("local"!==t.source||"update"!==e.$route.params.action)}},password:{component:c["o"],hidden:function(e){return"local"!==e.source||"custom"!==e.password_strategy&&!e.update_password},el:{required:!1,userIsOrgAdmin:!1}},need_update_password:{label:"",type:"checkbox-group",component:null,el:{style:"margin-bottom: -10px"},options:[{label:this.$t("ResetPasswordNextLogin"),value:!0}],hidden:function(e){return"local"!==e.source||"custom"!==e.password_strategy&&!e.update_password}},system_roles:{component:u["q"],rules:[p["f"].Required],el:{multiple:!0,ajax:{url:"/api/v1/rbac/system-roles/?id!=00000000-0000-0000-0000-000000000004",transformOption:function(e){return{label:e.display_name,value:e.id}}}},hidden:function(){return!e.$hasPerm("rbac.add_systemrolebinding")},value:[]},org_roles:{component:u["q"],label:this.$t("OrgRoles"),rules:this.$store.getters.currentOrgIsRoot?[]:[p["f"].RequiredChange],helpTextFormatter:function(){var s=function(){e.$router.push({name:"RoleList"})};return t("el-link",{on:{click:s}},[t("i",{class:"fa fa-external-link"})," ",r])},el:{multiple:!0,ajax:{url:"/api/v1/rbac/org-roles/",transformOption:function(e){return{label:e.display_name,value:e.id}}},disabled:this.$store.getters.currentOrgIsRoot,value:[]},hidden:function(){return!e.$store.getters.hasValidLicense||!e.$hasPerm("rbac.add_orgrolebinding")||e.$store.getters.currentOrgIsRoot}},groups:{helpTextAsPlaceholder:!0,el:{multiple:!0,disabled:this.$store.getters.currentOrgIsRoot,ajax:{url:"/api/v1/users/groups/"},value:[]}},phone:{component:c["h"]},is_active:{label:this.$t("IsActive"),el:{}}},submitMethod:function(){var e=this.$route.params;return e.id?"put":"post"},afterGetFormValue:function(e){var t,r;null!==e&&void 0!==e&&e.id&&(e.org_roles=null===(t=e.org_roles)||void 0===t?void 0:t.map((function(e){var t=e.id;return t})),e.system_roles=null===(r=e.system_roles)||void 0===r?void 0:r.map((function(e){var t=e.id;return t})),e.mfa_level.value=this.initial.mfa_level||e.mfa_level.value);return e},cleanFormValue:function(e){var t=this.submitMethod();return"post"===t&&"email"===e.password_strategy&&(delete e["password"],this.currentOrgIsRoot&&delete e["groups"]),void 0!==e.update_password&&delete e.update_password,"local"!==e.source&&delete e.need_update_password,[f["a"].allUsers,f["a"].onlyAdminUsers].indexOf(e.mfa_level)>-1&&delete e.mfa_level,e}}},computed:h({},Object(l["b"])(["currentOrgIsRoot","currentUser"])),mounted:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.currentOrgIsRoot&&(this.fieldsMeta.groups.el.disabled=!0),e.next=3,this.setDefaultRoles();case 3:this.disableMFAFieldIfNeed(null),this.loading=!1;case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),methods:{afterGetUser:function(e){var t=this;if(this.user=e,this.user.id===this.currentUser.id){var r=["system_roles","org_roles","is_active"];r.forEach((function(e){var r=t.$t("disallowSelfUpdateFields",{attr:t.fieldsMeta[e]["label"]});t.fieldsMeta[e].el.disabled=!0,t.fieldsMeta[e].helpTip=r}))}this.fieldsMeta.password.el.userIsOrgAdmin=e["is_org_admin"],this.$route.query.clone_from&&(this.user.groups=[]),this.disableMFAFieldIfNeed(e)},setDefaultRoles:function(){var e=Object(n["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$axios.get("/api/v1/rbac/roles/");case 2:t=e.sent,this.initial.system_roles=t.filter((function(e){return"User"===e.name})).map((function(e){return e.id})),this.initial.org_roles=t.filter((function(e){return"OrgUser"===e.name})).map((function(e){return e.id}));case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),disableMFAFieldIfNeed:function(e){var t=null,r=null,s=o["a"].getters.publicSettings["SECURITY_MFA_AUTH"],a=((null===e||void 0===e?void 0:e.is_superuser)||(null===e||void 0===e?void 0:e.is_org_admin))&&"update"===this.$route.meta.action&&s===f["b"].onlyAdminUsers;s===f["b"].allUsers&&(t=[{value:f["a"].allUsers,label:this.$t("MFAAllUsers")}],r=f["a"].allUsers),s===f["b"].onlyAdminUsers&&a&&(t=[{value:f["a"].onlyAdminUsers,label:this.$t("MFAOnlyAdminUsers")}],r=f["a"].onlyAdminUsers),null!==r&&null!==t&&(this.fieldsMeta["mfa_level"].options=t,this.initial.mfa_level=r)}}},_=g,v=(r("c97f"),r("2877")),b=Object(v["a"])(_,s,a,!1,null,"1e58fa4c",null);t["default"]=b.exports}}]);
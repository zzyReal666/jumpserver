(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-ba8afa44"],{"6ff8":function(e,t,n){},"8ab7":function(e,t,n){"use strict";n("dbc9")},"93d8":function(e,t,n){},af26:function(e,t,n){},bdfd:function(e,t,n){"use strict";n("6ff8")},c97d:function(e,t,n){"use strict";n("93d8")},dbc9:function(e,t,n){},f04d:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("AssetTreeTable",{ref:"AssetTreeTable",attrs:{"header-actions":e.headerActions,"quick-summary":e.quickSummary,"table-config":e.tableConfig,"tree-setting":e.treeSetting}}),e._v(" "),e.batchResolveDialog.visible?n("BatchResolveDialog",e._b({attrs:{visible:e.batchResolveDialog.visible},on:{"update:visible":function(t){return e.$set(e.batchResolveDialog,"visible",t)}}},"BatchResolveDialog",e.batchResolveDialog,!1)):e._e(),e._v(" "),e.detectDialog.visible?n("RiskScanDialog",{attrs:{asset:e.detectDialog.asset,visible:e.detectDialog.visible},on:{"update:visible":function(t){return e.$set(e.detectDialog,"visible",t)}}}):e._e()],1)},a=[],s=(n("7f7f"),n("ad09")),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("span",["0"===e.iValue?n("span",{staticClass:"risk-handler"},[n("el-dropdown",{attrs:{trigger:"click"},on:{command:e.handleDropdown,"visible-change":e.handleVisibleChange}},[n("el-button",{staticClass:"confirm action",attrs:{size:"mini"}},[n("i",{staticClass:"fa fa-check"})]),e._v(" "),n("el-dropdown-menu",{attrs:{slot:"dropdown"},slot:"dropdown"},e._l(e.actions,(function(t){return n("el-dropdown-item",{key:t.name,attrs:{command:t.name,disabled:t.disabled}},[e._v("\n          "+e._s(t.label)+"\n        ")])})),1)],1),e._v(" "),n("el-tooltip",{attrs:{content:e.$tc("IgnoreAlert"),"open-delay":400}},[n("el-button",{staticClass:"ignore action",attrs:{size:"mini",disabled:!this.$hasPerm("accounts.change_accountrisk")},on:{click:function(t){return e.handleDropdown("ignore")}}},[n("svg-icon",{attrs:{"icon-class":"ignore"}})],1)],1)],1):n("el-tooltip",{staticClass:"platform-status",attrs:{content:e.iLabel,"open-delay":400}},[n("el-button",{attrs:{size:"mini",type:"text"},on:{click:e.showDetail}},[n("span",{staticClass:"detail-icon"},["1"===e.iValue?n("i",{staticClass:"fa fa-check-circle color-primary"}):n("svg-icon",{attrs:{"icon-class":"ignore"}})],1)])],1),e._v(" "),n("ReviewDraw",{attrs:{row:e.row,rows:e.rows,"selected-rows":e.selectedRows,"show-buttons":e.reviewButtons,visible:e.reviewDrawer},on:{"update:visible":function(t){e.reviewDrawer=t},handle:e.handleDrawerEvent}}),e._v(" "),n("ProcessingDialog",{attrs:{visible:e.processing}})],1)},o=[],c=(n("ac4d"),n("8a81"),n("5df3"),n("1c4c"),n("6b54"),n("87b3"),n("1c01"),n("58b2"),n("8e6e"),n("f3e2"),n("d25f"),n("456d"),n("6762"),n("2fdb"),n("2caf"),n("bd86")),u=n("768b"),l=(n("ac6a"),n("ffc1"),n("96cf"),n("3b8d")),h=n("e059"),d=n("73c8"),f=n("3f95"),p=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("el-drawer",{staticClass:"risk-review-drawer",staticStyle:{"z-index":"999"},attrs:{title:e.$t("Details"),visible:e.iVisible,"append-to-body":"","destroy-on-close":"",direction:"rtl"},on:{"update:visible":function(t){e.iVisible=t}}},[n("div",{staticClass:"drawer-container"},[n("div",{staticClass:"drawer-body"},e._l(e.iRows,(function(t){return n("div",{key:t.id,staticClass:"risk-item"},[n("IBox",{attrs:{title:e.getAccountTitle(t)}},[n("el-timeline",{attrs:{reverse:!0}},e._l(t.details,(function(r){return n("el-timeline-item",{key:r.datetime,attrs:{icon:e.getDetailIcon(r),timestamp:e.formatTimestamp(r.datetime),type:e.getDetailType(r),placement:"top"}},[n("span",{domProps:{innerHTML:e.$xss.process(e._s(e.handleDetail(t,r)))}})])})),1)],1)],1)})),0),e._v(" "),e.isRootOrg?e._e():n("div",{staticClass:"drawer-footer"},[e.isBatch?n("div",[n("el-input",{attrs:{placeholder:e.$tc("PleaseEnterReason"),type:"textarea"},model:{value:e.comment,callback:function(t){e.comment=t},expression:"comment"}}),e._v(" "),n("span",{staticClass:"buttons"},[n("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.handleClose}},[e._v("\n            "+e._s(e.$t("Close"))+"\n          ")]),e._v(" "),n("el-button",{attrs:{size:"small"},on:{click:e.handleIgnore}},[e._v("\n            "+e._s(e.$t("IgnoreAlert"))+"\n          ")])],1)],1):n("div",[n("el-button",{attrs:{size:"small"},on:{click:e.handleReopen}},[e._v(e._s(e.$t("Reopen")))])],1)])])])},m=[],b=(n("0cd8"),n("f400"),n("0692"));function v(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=g(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function g(e,t){if(e){if("string"===typeof e)return w(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?w(e,t):void 0}}function w(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var k=new Map;function y(e,t){return R.apply(this,arguments)}function R(){return R=Object(l["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(r="".concat(t,"-").concat(n),!k.has(r)){e.next=3;break}return e.abrupt("return",k.get(r));case 3:return a="/api/v1/accounts/accounts/?username=".concat(encodeURIComponent(t),"&asset=").concat(n),e.next=6,this.$axios.get(a);case 6:return s=e.sent,i=s.length>0,k.set(r,i),e.abrupt("return",i);case 10:case"end":return e.stop()}}),e,this)}))),R.apply(this,arguments)}function x(){return D.apply(this,arguments)}function D(){return D=Object(l["a"])(regeneratorRuntime.mark((function e(){var t,n,r;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(!(this.rows.length>0)){e.next=21;break}t=v(this.rows),e.prev=2,t.s();case 4:if((n=t.n()).done){e.next=12;break}return r=n.value,e.next=8,y.call(this,r.username,r.asset.id);case 8:if(e.sent){e.next=10;break}return e.abrupt("return",!1);case 10:e.next=4;break;case 12:e.next=17;break;case 14:e.prev=14,e.t0=e["catch"](2),t.e(e.t0);case 17:return e.prev=17,t.f(),e.finish(17);case 20:return e.abrupt("return",!0);case 21:if(!this.row.username){e.next=25;break}return e.next=24,y.call(this,this.row.username,this.row.asset.id);case 24:return e.abrupt("return",e.sent);case 25:return e.abrupt("return",!1);case 26:case"end":return e.stop()}}),e,this,[[2,14,17,20]])}))),D.apply(this,arguments)}var $=[{name:"delete_remote",label:b["a"].t("SyncDeleteSelected"),has:["long_time_no_login","new_found"],disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.remove_account")||!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"delete_both",label:b["a"].t("DeleteBoth"),has:["long_time_no_login"],disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.remove_account")||!this.$hasPerm("accounts.delete_account")||!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"add_account",label:b["a"].t("AddAccount"),has:["new_found"],disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.add_account")||!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"change_password_add",label:b["a"].t("AddAccountAfterChangingPassword"),has:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=["new_found","long_time_password","password_expired"],e.t0=t.includes(this.row.risk.value),!e.t0){e.next=6;break}return e.next=5,x.call(this);case 5:e.t0=!e.sent;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.add_pushaccountexecution")||!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"change_password",label:b["a"].t("ChangePassword"),has:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=["long_time_password","weak_password","password_expired","leaked_password","repeated_password"],e.t0=t.includes(this.row.risk.value),!e.t0){e.next=6;break}return e.next=5,x.call(this);case 5:e.t0=e.sent;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.add_changesecretexecution")||!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"delete_account",label:b["a"].t("DeleteAccount"),has:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t=["account_deleted"],e.t0=t.includes(this.row.risk.value),!e.t0){e.next=6;break}return e.next=5,x.call(this);case 5:e.t0=e.sent;case 6:return e.abrupt("return",e.t0);case 7:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.delete_account")||!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"review",label:b["a"].t("Review"),has:["group_changed","sudo_changed","authorized_key_changed","account_deleted","others"],disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.change_accountrisk")||!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"ignore",label:b["a"].t("Ignore"),has:!1,disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"reopen",label:b["a"].t("Reopen"),has:!1,disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{name:"close",label:b["a"].t("Close"),has:!1,disabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.abrupt("return",!this.$hasPerm("accounts.change_accountrisk"));case 1:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()}],O=n("e9f9"),A={name:"ReviewDraw",components:{IBox:O["a"]},props:{row:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1},showButtons:{type:Boolean,default:!0},rows:{type:Array,default:function(){return[]}},selectedRows:{type:Array,default:function(){return[]}}},data:function(){return{riskActions:$,comment:""}},computed:{iVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},actionMap:function(){return $.reduce((function(e,t){return e[t.name]=t,e}),{})},iRows:function(){return 0===this.rows.length?[this.row]:this.selectedRows},isBatch:function(){return this.selectedRows.length>0&&this.selectedRows[0]&&this.selectedRows[0].status?"0"===this.selectedRows[0].status.value:!!this.row.status&&"0"===this.row.status.value},isRootOrg:function(){return this.$store.getters.currentOrgIsRoot}},methods:{getAccountTitle:function(e){var t,n;return e.account?(t=e.account.asset,n=e.account.username):(t=e.asset,n=e.username),"".concat(n,"@").concat(t.name)},handleClose:function(){this.$emit("handle",{action:"close",comment:this.comment})},formatTimestamp:function(e){return Object(f["i"])(e)},handleReopen:function(){this.$emit("handle",{action:"reopen"})},handleIgnore:function(){this.$emit("handle",{action:"ignore",comment:this.comment})},getDetailIcon:function(e){if("reopen"===e.action)return"el-icon-refresh";switch(e.status){case"1":return"el-icon-check";case"2":return"el-icon-close-notification";default:return""}},getDetailType:function(e){if("process"!==e.type)return"warning";switch(e.action){case"ignore":return"danger";case"reopen":return"primary";default:return"success"}},handleDetail:function(e,t){return!t.type||["init","refind"].includes(t.type)?this.handleInit(e,t):"process"===t.type?this.handleProcess(e,t):void 0},handleProcess:function(e,t){var n,r=t.action,a=t.processor,s=t.comment,i=(null===(n=this.actionMap[r])||void 0===n?void 0:n.label)||r;return s&&(i="".concat(i," (").concat(s,")")),"\n          <div>".concat(i,'</div>\n          <div class="processor"><i class="fa fa-user-o"></i> <span> ').concat(a,"</span></div>\n      ")},handleInit:function(e,t){switch(e.risk.value){case"new_found":return this.$tc("NewFound");case"long_time_no_login":return this.$tc("LastLoginTime")+": "+this.formatTimestamp(t.date);case"group_changed":case"sudoers_changed":case"authorized_key_changed":return this.$t("Diff")+":\n            <pre>\n              ".concat(t.diff,"\n            </pre>\n            ");case"long_time_password":return this.$t("LastChangeTime")+": "+this.formatTimestamp(t.date);case"account_deleted":return this.$t("AccountDeleted");case"weak_password":return this.$t("WeakPassword");case"repeat_password":return this.$t("RepeatPassword");case"leak_password":return this.$t("LeakPassword");default:return this.$t("Other")}}}},j=A,C=(n("c97d"),n("2877")),P=Object(C["a"])(j,p,m,!1,null,"55991fde",null),S=P.exports;function T(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=I(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function I(e,t){if(e){if("string"===typeof e)return V(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?V(e,t):void 0}}function V(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function E(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){Object(c["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var z={name:"RiskSummaryFormatter",components:{ProcessingDialog:h["a"],ReviewDraw:S},extends:d["a"],props:{formatterArgsDefault:{type:Object,default:function(){return{}}},changed:{type:Boolean,default:!1},rows:{type:Array,default:function(){return[]}},selectedRows:{type:Array,default:function(){return[]}}},data:function(){return{processing:!1,reviewDrawer:!1,reviewButtons:!0,showViewSecretDialog:!1,account:{},secretUrl:"",actions:[],formatterArgs:Object.assign(this.formatterArgsDefault,this.col.formatterArgs)}},computed:{iActions:function(){return this.getActions()},iValue:function(){return this.cellValueIsLabelChoice()?this.cellValue.value:this.cellValue},iLabel:function(){return this.cellValueIsLabelChoice()?this.cellValue.label:this.cellValue}},watch:{changed:function(){this.handleVisibleChange(!0)}},methods:{handleDrawerEvent:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=t.action,delete t.action,e.next=4,this.handleCommon(n,t);case 4:this.reviewDrawer=!1;case 5:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),showDetail:function(){this.reviewDrawer=!0},showReview:function(){if(0===this.selectedRows.length&&!this.row.id)return this.$message.warning(this.$t("PleaseSelectTheDataYouWantToCheck"));this.reviewDrawer=!0},handleCommon:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t,n){var r,a,s,i,o,c,l,h,d=this;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:r=this.rows,0===this.rows.length&&(r=[this.row],this.processing=!0),n||(n={}),a=0,s=Object.entries(r);case 4:if(!(a<s.length)){e.next=26;break}return i=Object(u["a"])(s[a],2),o=i[0],c=i[1],l=E({username:c.username,asset:c.asset.id,risk:c.risk.value,action:t},n),c.status={value:"3",label:this.$t("Processing")},h={},e.prev=9,e.next=12,this.$axios.post("/api/v1/accounts/account-risks/handle/",l);case 12:h=e.sent,e.next=19;break;case 15:return e.prev=15,e.t0=e["catch"](9),this.$emit("processDone",{index:o,row:c}),e.abrupt("continue",23);case 19:return e.next=21,Object(f["g"])(100);case 21:h.status?Object.assign(c,h):c.status="ignore"!==t?{value:"1",label:this.$t("Confirmed")}:{value:"2",label:this.$t("Ignored")},this.$emit("processDone",{index:o,row:c});case 23:a++,e.next=4;break;case 26:setTimeout((function(){d.processing=!1}),500);case 27:case"end":return e.stop()}}),e,this,[[9,15]])})));function t(t,n){return e.apply(this,arguments)}return t}(),handleDropdown:function(e){"review"===e?this.showReview():this.handleCommon(e)},checkDisabled:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=void 0!==t.disabled&&t.disabled,"function"!==typeof n){e.next=5;break}return e.next=4,t.disabled.call(this);case 4:n=e.sent;case 5:return e.abrupt("return",n);case 6:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),handleVisibleChange:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return",!1);case 2:if(0!==this.actions.length&&!0!==this.changed){e.next=6;break}return e.next=5,this.getActions();case 5:this.actions=e.sent;case 6:return e.abrupt("return",this.actions.length>0);case 7:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),checkHas:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=void 0!==t.has&&t.has,"function"!==typeof n){e.next=5;break}return e.next=4,t.has.call(this);case 4:return e.abrupt("return",e.sent);case 5:if(!Array.isArray(n)){e.next=7;break}return e.abrupt("return",n.includes(this.row.risk.value)||"review"===t.name);case 7:return e.abrupt("return",!1);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}(),getActions:function(){var e=Object(l["a"])(regeneratorRuntime.mark((function e(){var t,n,r,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:t=_.cloneDeep($),n=[],r=T(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=19;break}return s=a.value,e.next=9,this.checkDisabled(s);case 9:if(e.t0=e.sent,e.t0){e.next=12;break}e.t0="review"!==s.name&&this.$store.getters.currentOrgIsRoot;case 12:return s.disabled=e.t0,e.next=15,this.checkHas(s);case 15:i=e.sent,i&&n.push(s);case 17:e.next=5;break;case 19:e.next=24;break;case 21:e.prev=21,e.t1=e["catch"](3),r.e(e.t1);case 24:return e.prev=24,r.f(),e.finish(24);case 27:return e.abrupt("return",n);case 28:case"end":return e.stop()}}),e,this,[[3,21,24,27]])})));function t(){return e.apply(this,arguments)}return t}()}},L=z,M=(n("fcc0"),Object(C["a"])(L,i,o,!1,null,"83ce9bcc",null)),U=M.exports,H=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dialog",{attrs:{"destroy-on-close":!0,"show-buttons":!1,title:e.$tc("ResolveSelected"),visible:e.iVisible},on:{"update:visible":function(t){e.iVisible=t}}},[n("div",[n("el-form",{staticClass:"el-form"},[n("el-form-item",{staticClass:"risk-select",attrs:{prop:"selected"}},[n("el-select",{attrs:{placeholder:e.$t("SelectRisk")},model:{value:e.riskSelected,callback:function(t){e.riskSelected=t},expression:"riskSelected"}},e._l(e.riskTypes,(function(e){return n("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),e._v(" "),n("HandleDropdown",{staticClass:"risk-handler",attrs:{"cell-value":e.fakeCell,changed:e.changed,row:e.fakeRow,rows:e.tableConfig.totalData,"selected-rows":e.selectedRows,value:1},on:{processDone:e.handleProcessDone}})],1),e._v(" "),n("DataTable",e._g({ref:"table",attrs:{config:e.tableConfig},on:{"selection-change":e.handleSelectionChange}},e.$listeners))],1)])},q=[],N=(n("6d67"),n("9039")),W=n("1cf5");function F(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=J(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,i=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return i=e.done,e},e:function(e){o=!0,s=e},f:function(){try{i||null==n.return||n.return()}finally{if(o)throw s}}}}function J(e,t){if(e){if("string"===typeof e)return Y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Y(e,t):void 0}}function Y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var G={name:"BatchResolveDialog",components:{DataTable:W["a"],Dialog:N["a"],HandleDropdown:U},props:{visible:{type:Boolean,default:!1},risks:{type:Array,default:function(){return[]}}},data:function(){return{changed:!1,riskSelected:"",fakeRow:{id:"",risk:{}},selectedRows:[],fakeCell:{value:"0",label:this.$t("Pending")},tableConfig:{url:"",totalData:[],columns:[{prop:"asset",label:this.$t("Asset"),formatter:function(e){return e.asset.name}},{prop:"username",label:this.$t("Username")},{prop:"risk",label:this.$t("Risk"),formatter:function(e){return e.risk.label}},{prop:"status",label:this.$t("Status"),formatter:function(e){return e.status.label}}]}}},computed:{iVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}},riskTypes:function(){var e,t={},n=F(this.unconfirmedRisks);try{for(n.s();!(e=n.n()).done;){var r=e.value;t[r.risk.value]||(t[r.risk.value]=r.risk.label)}}catch(a){n.e(a)}finally{n.f()}return Object.keys(t).map((function(e){return{value:e,label:t[e]}}))},unconfirmedRisks:function(){return this.risks.filter((function(e){return"0"===e.status.value}))},dataTable:function(){return this.$refs.table.$refs.table},pageSize:function(){return this.dataTable.size},dataTableCurrentPage:function(){return this.dataTable.page}},watch:{riskSelected:function(e){var t=this;this.tableConfig.totalData=e?this.unconfirmedRisks.filter((function(e){return e.risk.value===t.riskSelected})):this.unconfirmedRisks.filter((function(e){return"0"===e.status.value})),this.fakeRow.risk={value:this.riskSelected},this.changed=!0,setTimeout((function(){t.changed=!1}),200)}},mounted:function(){this.tableConfig.totalData=this.unconfirmedRisks},methods:{handleProcessDone:function(e){var t=e.index,n=(e.row,this.dataTable.page),r=this.dataTable.size,a=Math.floor(t/r);n<a+1&&this.dataTable.gotoNextPage()},handleSelectionChange:function(e){this.selectedRows=e}}},K=G,Q=(n("bdfd"),Object(C["a"])(K,H,q,!1,null,"1b93eb11",null)),X=Q.exports,Z=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("Dialog",{attrs:{"destroy-on-close":!0,"show-cancel":!1,"show-confirm":!1,title:e.$tc("Detecting"),visible:e.iVisible,top:"35vh",width:"80%"},on:{"update:visible":function(t){e.iVisible=t},close:function(t){e.loading=!0}}},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}]},[n("iframe",{attrs:{src:e.url,frameborder:"0"},on:{load:e.onIframeLoad}})])])},ee=[],te={name:"RiskScanDialog",components:{Dialog:N["a"]},props:{visible:{type:Boolean,default:!1},asset:{type:String,default:""}},data:function(){return{loading:!0,url:"/api/v1/accounts/check-account-executions/adhoc/?asset_id=".concat(this.asset)}},computed:{iVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{onIframeLoad:function(){this.loading=!1}}},ne=te,re=(n("8ab7"),Object(C["a"])(ne,Z,ee,!1,null,"0ee1dcb9",null)),ae=re.exports,se=n("53f7"),ie={components:{RiskScanDialog:ae,BatchResolveDialog:X,AssetTreeTable:s["a"]},data:function(){var e=this.$createElement,t=this;return{gatherAccounts:[],scanVisible:!1,detectDialog:{visible:!1,asset:""},treeSetting:{showMenu:!0,showRefresh:!0,showSearch:!0,showAssets:!0,notShowBuiltinTree:!0,url:"/api/v1/accounts/account-risks/",nodeUrl:"/api/v1/assets/nodes/",treeUrl:"/api/v1/assets/nodes/children/tree/?assets=1&asset_amount=0",menu:[{id:"check",name:this.$t("Check"),icon:"scan",callback:function(e){t.detectDialog.asset=e.id,setTimeout((function(){t.detectDialog.visible=!0}),100)}}]},quickSummary:[{title:this.$t("DateLastWeek"),filter:{days:"7"}},{title:this.$t("DateLastMonth"),filter:{days:"30"}},{title:this.$t("Pending"),filter:{status:"0"}}],batchResolveDialog:{visible:!1,risks:[]},tableConfig:{url:"/api/v1/accounts/account-risks/",columns:["asset","username","risk","status","date_created"],columnsMeta:{asset:{formatter:se["i"],formatterArgs:{can:t.$hasPerm("assets.view_asset"),getTitle:function(e){var t=e.row;return t.asset.name},getDrawerTitle:function(e){var t=e.row;return t.asset.name},getRoute:function(e){var t=e.row;return{name:"AssetDetail",params:{id:t.asset.id}}},drawer:!0}},username:{label:this.$t("Account"),width:"120px"},risk:{formatter:function(t){return e("el-tag",{attrs:{size:"mini",type:"danger",effect:"plain"}},[t.risk.label])}},status:{label:t.$t("Pending"),width:"120px",formatter:U,el:{"show-overflow-tooltip":!1}},actions:{has:!1}}},headerActions:{hasCreate:!1,hasImport:!1,extraMoreActions:[{name:"resolveSelected",title:this.$t("ResolveSelected"),icon:"el-icon-check",callback:function(e){var n=e.selectedRows;t.batchResolveDialog.risks=n,t.batchResolveDialog.visible=!0},can:function(e){var n=e.selectedRows;return n.length>0&&t.$hasPerm("accounts.change_accountrisk")}}]}}},mounted:function(){this.checkPayload()},methods:{checkPayload:function(){var e=this.$route.query.payload;if(e){var t="&risk=".concat(e);t&&(this.tableConfig.url+=t)}}}},oe=ie,ce=Object(C["a"])(oe,r,a,!1,null,"6acf8331",null);t["default"]=ce.exports},fcc0:function(e,t,n){"use strict";n("af26")}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0b3dbf42"],{"0218":function(t,e,s){"use strict";s.d(e,"c",(function(){return n})),s.d(e,"a",(function(){return o})),s.d(e,"d",(function(){return c})),s.d(e,"b",(function(){return l})),s.d(e,"f",(function(){return r})),s.d(e,"e",(function(){return u})),s.d(e,"g",(function(){return d}));var a=s("bd86"),i=s("0692"),n="pending",o="approved",c="rejected",l="closed",r=Object(a["a"])(Object(a["a"])(Object(a["a"])(Object(a["a"])({},n,{type:"success",title:i["a"].t("Pending")}),o,{type:"primary",title:i["a"].t("Approved")}),c,{type:"danger",title:i["a"].t("Rejected")}),l,{type:"info",title:i["a"].t("Closed")}),u=Object(a["a"])(Object(a["a"])(Object(a["a"])(Object(a["a"])({},n,{type:"success",title:i["a"].t("Pending")}),o,{type:"primary",title:i["a"].t("Approved")}),c,{type:"danger",title:i["a"].t("Rejected")}),l,{type:"warning",title:i["a"].t("StateClosed")}),d=[{value:"all",label:i["a"].t("All"),children:[{value:"connect",label:i["a"].t("Connect")},{value:"delete",label:i["a"].t("Delete")},{value:"share",label:i["a"].t("Share")},{value:"updownload",label:i["a"].t("UpDownload"),children:[{value:"upload",label:i["a"].t("Upload")},{value:"download",label:i["a"].t("Download")}]},{value:"copy_paste",label:i["a"].t("Clipboard"),children:[{value:"copy",label:i["a"].t("Copy")},{value:"paste",label:i["a"].t("Paste")}]}]}]},1835:function(t,e,s){},"7b4e":function(t,e,s){},"80b0":function(t,e,s){"use strict";s("fc65")},8463:function(t,e,s){},"970f":function(t,e,s){"use strict";s("7b4e")},"9cdc":function(t,e,s){"use strict";var a=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{md:17,sm:24}},[s("Details",{attrs:{"detail-card-items":t.iDetailCardItems,title:t.$tc("BasicInfo")}}),t._v(" "),t.specialCardItems.length>0?s("Details",{attrs:{"detail-card-items":t.specialCardItems,title:t.$tc("ApplyInfo")}}):t._e(),t._v(" "),"approved"===t.object.state.value&&t.assignedCardItems.length>0?s("Details",{attrs:{"detail-card-items":t.assignedCardItems,title:t.$tc("AssignedInfo")}}):t._e(),t._v(" "),t._t("default",null,{id:"MoreDetails"}),t._v(" "),s("Comments",t._b({attrs:{object:t.object}},"Comments",t.$attrs,!1))],2),t._v(" "),s("el-col",{attrs:{md:7,sm:24}},[s("Steps",{attrs:{object:t.object}}),t._v(" "),s("Session",{directives:[{name:"perms",rawName:"v-perms",value:"tickets.view_ticket",expression:"'tickets.view_ticket'"}],attrs:{object:t.object}})],1)],1)},i=[],n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("IBox",{staticClass:"box"},[s("div",{staticClass:"clearfix ibox-title",attrs:{slot:"header"},slot:"header"},[s("i"),t._v(" "+t._s(t.title)+"\n  ")]),t._v(" "),s("div",{staticClass:"content"},[s("el-row",{attrs:{gutter:10}},t._l(t.detailCardItems,(function(e){return s("el-col",{key:"card-"+e.key,staticStyle:{display:"flex"},attrs:{md:12,sm:12}},[s("div",{staticClass:"item-label",style:{"text-align":"align"}},[s("label",[t._v(t._s(e.key)+": ")])]),t._v(" "),s("div",{staticClass:"item-text"},[s("ItemValue",t._b({},"ItemValue",e,!1))],1)])})),1),t._v(" "),t.specialCardItems.length>0?s("el-divider"):t._e(),t._v(" "),s("el-row",{attrs:{gutter:10}},t._l(t.specialCardItems,(function(e){return s("el-col",{key:"card-"+e.key,staticStyle:{display:"flex"},attrs:{md:12,sm:12}},[s("div",{staticClass:"item-label",style:{"text-align":"align"}},[s("label",[t._v(t._s(e.key)+": ")])]),t._v(" "),s("div",{staticClass:"item-text"},[s("ItemValue",t._b({},"ItemValue",e,!1))],1)])})),1)],1)])},o=[],c=s("14d8"),l=s("e9f9"),r={name:"Details",components:{ItemValue:c["a"],IBox:l["a"]},props:{specialCardItems:{type:Array,default:function(){return[]}},detailCardItems:{type:Array,default:function(){return[]}},title:{type:String,default:""}},data:function(){return{}}},u=r,d=(s("80b0"),s("2877")),p=Object(d["a"])(u,n,o,!1,null,"f848df18",null),m=p.exports,v=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("IBox",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"box"},[s("div",{staticClass:"clearfix ibox-title",attrs:{slot:"header"},slot:"header"},[s("i",{staticClass:"fa fa-comments"}),t._v(" "+t._s(t.$t("Message"))+"\n  ")]),t._v(" "),t.comments?t._l(t.comments,(function(e){return s("div",{key:e.id,staticClass:"feed-activity-list"},[s("div",{staticClass:"feed-element"},[s("a",{staticClass:"pull-left",attrs:{href:"#"}},[s("el-avatar",{staticClass:"header-avatar",attrs:{size:30,src:t.imageUrl}})],1),t._v(" "),s("div",{staticClass:"media-body "},[s("strong",[t._v(t._s(e.user_display))]),t._v(" "),s("small",{staticClass:"text-muted"},[t._v(t._s(t._f("date")(e.date_created)))]),t._v(" "),s("MarkDown",{attrs:{value:e.body}})],1)])])})):t._e(),t._v(" "),t._t("default"),t._v(" "),s("el-form",{ref:"comments",staticStyle:{"padding-top":"20px"},attrs:{model:t.form,"label-width":"45px"}},[t.isAuditRoute?t._e():s("el-form-item",{attrs:{label:t.$tc("Reply")}},[s("el-input",{attrs:{autosize:{minRows:4},type:"textarea"},model:{value:t.form.comments,callback:function(e){t.$set(t.form,"comments",e)},expression:"form.comments"}})],1),t._v(" "),s("el-form-item",{staticStyle:{float:"right"}},[t.hasActionPerm&&!t.isAuditRoute?[s("el-button",{attrs:{disabled:t.isDisabled||"closed"===t.object.status.value,size:"small",type:"primary"},on:{click:t.handleApprove}},[s("i",{staticClass:"fa fa-check"}),t._v(" "+t._s(t.$t("Accept"))+"\n        ")]),t._v(" "),s("el-button",{attrs:{disabled:t.isDisabled||"closed"===t.object.status.value,size:"small",type:"warning"},on:{click:t.handleReject}},[s("i",{staticClass:"fa fa-ban"}),t._v(" "+t._s(t.$t("Reject"))+"\n        ")])]:t._e(),t._v(" "),t.isSelfTicket&&!t.isAuditRoute?s("el-button",{attrs:{disabled:t.isDisabled||"closed"===t.object.status.value,size:"small",type:"danger"},on:{click:t.handleClose}},[s("i",{staticClass:"fa fa-times"}),t._v(" "+t._s(t.$t("CancelTicket"))+"\n      ")]):t._e(),t._v(" "),t.isAuditRoute?t._e():s("el-button",{attrs:{disabled:"closed"===t.object.status.value,size:"small",type:"info"},on:{click:t.handleComment}},[s("i",{staticClass:"fa fa-pencil"}),t._v(" "+t._s(t.$t("Reply"))+"\n      ")])],2)],1)],2)},f=[],_=(s("d25f"),s("57e7"),s("7f7f"),s("3f95")),h=s("8112"),b={name:"Comments",components:{IBox:l["a"],MarkDown:h["a"]},props:{object:{type:Object,default:function(){return{}}},approve:{type:Function,default:null},reject:{type:Function,default:null},close:{type:Function,default:null}},data:function(){return{isDisabled:!1,comments:"",type_api:"",imageUrl:s("690a"),form:{comments:""},loading:!1}},computed:{isAuditRoute:function(){return"AuditTicketList"===this.$route.name},hasActionPerm:function(){var t=this;return-1!==this.object.process_map.filter((function(e){return e.approval_level===t.object.approval_step.value}))[0].assignees.indexOf(this.$store.state.users.profile.id)},isSelfTicket:function(){var t=this.$store.state.users.profile;return this.object.applicant==="".concat(t.name,"(").concat(t.username,")")}},mounted:function(){switch(this.object.type.value){case"login_confirm":this.type_api="apply-login-tickets";break;case"apply_asset":this.type_api="apply-asset-tickets";break;case"login_asset_confirm":this.type_api="apply-login-asset-tickets";break;case"command_confirm":this.type_api="apply-command-tickets";break;default:this.type_api="tickets"}this.getComment()},methods:{formatTime:function(t){return Object(_["a"])(Object(_["b"])(t))},toSafeLocalDateStr:function(t){return Object(_["i"])(t)},getComment:function(){var t=this;this.loading=!0;var e="/api/v1/tickets/comments/?ticket_id=".concat(this.object.id);this.$axios.get(e).then((function(e){t.comments=e})).catch((function(e){t.$message.error(e)})).finally((function(){t.loading=!1,t.form.comments=""}))},defaultApprove:function(){var t=this;this.createComment((function(){}));var e="/api/v1/tickets/".concat(this.type_api,"/").concat(this.object.id,"/approve/");this.$axios.put(e).then((function(e){t.reloadPage()})).catch((function(e){t.$message.error(e)})).finally((function(){t.isDisabled=!1}))},defaultReject:function(){var t=this;this.createComment((function(){}));var e="/api/v1/tickets/".concat(this.type_api,"/").concat(this.object.id,"/reject/");this.$axios.put(e).then((function(e){t.reloadPage()})).catch((function(e){t.$message.error(e)})).finally((function(){t.isDisabled=!1}))},defaultClose:function(){var t=this,e="/api/v1/tickets/".concat(this.type_api,"/").concat(this.object.id,"/close/");this.$axios.put(e).then((function(e){t.reloadPage()})).catch((function(e){t.$message.error(e)})).finally((function(){t.isDisabled=!1}))},createComment:function(t){var e=this,s=this.form.comments,a=this.object.id,i="/api/v1/tickets/comments/?ticket_id=".concat(this.object.id);if(s){var n={body:s,ticket:a};this.$axios.post(i,n).then((function(s){t?t():e.reloadPage()}))}},handleAction:function(t){if(!this.isDisabled){var e;switch(this.isDisabled=!0,t){case"approve":e=this.approve||this.defaultApprove;break;case"reject":e=this.reject||this.defaultReject;break;case"close":e=this.close||this.defaultClose;break;default:e=null;break}e?e():this.$message.error("No handler for action")}},handleApprove:function(){this.handleAction("approve")},handleReject:function(){this.handleAction("reject")},handleClose:function(){this.handleAction("close")},handleComment:function(){this.createComment(this.getComment)},reloadPage:function(){window.location.reload()}}},y=b,g=(s("fa8d"),Object(d["a"])(y,v,f,!1,null,"253bb560",null)),k=g.exports,C=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("IBox",[s("div",{staticStyle:{height:"660px"}},[s("el-steps",{attrs:{active:t.ticketSteps,direction:"vertical"}},[s("el-step",{attrs:{description:this.$t("Applicant")+"："+t.object.rel_snapshot.applicant,title:this.$t("OpenTicket")+"："+t.object.title}},[s("div",{staticClass:"description",attrs:{slot:"description"},slot:"description"},[s("div",[t._v(t._s(this.$t("Applicant")+"："+t.object.rel_snapshot.applicant))]),t._v(" "),s("div",[t._v(t._s(this.$t("DateCreated")+": "+t.toSafeLocalDateStr(t.object.date_created)))])])]),t._v(" "),t._l(t.process_map,(function(e,a){return s("el-step",{key:a,attrs:{title:t.$tc("HandleTicket")}},[s("div",{attrs:{slot:"description"},slot:"description"},[s("div",{staticClass:"processors"},[s("div",{staticClass:"processors-content"},t._l(e.assignees_display.slice(0,4),(function(e){return s("span",{key:e,staticStyle:{display:"block"}},[t._v("\n                "+t._s(e)+"\n              ")])})),0),t._v(" "),e.assignees.length>4?s("el-button",{attrs:{type:"text"},on:{click:function(s){return t.lookOver(e.assignees_display)}}},[t._v("\n              "+t._s(t.$tc("CheckViewAcceptor"))+"\n            ")]):t._e()],1)]),t._v(" "),"closed"===e.state?s("div",{attrs:{slot:"description"},slot:"description"},[s("div",[t._v(t._s(t.$t("Assignee"))+": "+t._s(t.object.rel_snapshot.applicant))]),t._v(" "),s("div",[t._v(t._s(t.$t("DateFinished"))+": "+t._s(t.toSafeLocalDateStr(e.approval_date)))])]):t._e(),t._v(" "),"pending"!==e.state&&"closed"!==e.state?s("div",{attrs:{slot:"description"},slot:"description"},[s("div",[t._v(" "+t._s(t.$t("Assignee"))+": "+t._s(e.processor_display))]),t._v(" "),s("div",[t._v(t._s(t.$t("DateFinished"))+": "+t._s(t.toSafeLocalDateStr(e.approval_date)))])]):t._e()])})),t._v(" "),s("el-step",{attrs:{title:""+this.$t("FinishedTicket")}},["closed"===t.object.status.value?s("div",{attrs:{slot:"description"},slot:"description"},[s("div",[t._v(t._s(t.$t("DateFinished"))+": "+t._s(t.toSafeLocalDateStr(t.object.date_updated)))])]):t._e()])],2)],1)])},j=[],$=(s("ac6a"),s("f3e2"),s("55dd"),s("0218")),x={name:"Steps",components:{IBox:l["a"]},props:{object:{type:Object,default:function(){return{}}}},data:function(){return{status:{open:2,close:3},process_map:this.object.process_map.sort((function(t,e){return t.approval_level-e.approval_level}))||[],vm:this,statusMap:$["e"]}},computed:{ticketSteps:function(){var t=0;return this.process_map.forEach((function(e){"approved"===e.state&&(t+=1)})),t===this.process_map.length?this.process_map.length+2:this.status.open+t}},methods:{formatTime:function(t){return Object(_["a"])(Object(_["b"])(t))},toSafeLocalDateStr:function(t){return Object(_["i"])(t)},lookOver:function(t){var e=this.$createElement,s=[];t.forEach((function(t){s.push(e("p",null,t))})),this.$msgbox({title:this.$t("RelevantAssignees"),customClass:"acceptance",message:e("p",null,s),showCancelButton:!1,showConfirmButton:!1})}}},S=x,w=(s("eb91"),s("e377"),Object(d["a"])(S,C,j,!1,null,"7c3c6e2e",null)),A=w.exports,D=function(){var t=this,e=t.$createElement,s=t._self._c||e;return t.session.id?s("IBox",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"box"},[s("div",{staticClass:"clearfix ibox-title",attrs:{slot:"header"},slot:"header"},[s("i",{staticClass:"fa fa-rocket"}),t._v("\n    "+t._s(t.$t("Session"))+"\n  ")]),t._v(" "),s("div",{staticClass:"content"},[s("el-row",{staticClass:"item"},[s("el-col",[s("span",{staticClass:"item-label"},[t._v(t._s(t.$t("SessionID"))+"：")]),t._v(" "),s("span",{staticClass:"item-value"},[t._v(t._s(t.session.id))])]),t._v(" "),s("el-col",[s("span",{staticClass:"item-label"},[t._v(t._s(t.$t("TargetResources"))+"：")]),t._v(" "),s("span",{staticClass:"item-value"},[t._v(t._s(t.session.asset))])]),t._v(" "),s("el-col",[s("span",{staticClass:"item-label"},[t._v(t._s(t.$t("Account"))+"：")]),t._v(" "),s("span",{staticClass:"item-value"},[t._v(t._s(t.session.account))])]),t._v(" "),s("el-col",[s("span",{staticClass:"item-label"},[t._v(t._s(t.$t("UseProtocol"))+"：")]),t._v(" "),s("span",{staticClass:"item-value"},[t._v(t._s(t.session.protocol))])]),t._v(" "),s("el-col",[s("span",{staticClass:"item-label"},[t._v(t._s(t.$t("RemoteAddr"))+"：")]),t._v(" "),s("span",{staticClass:"item-value"},[t._v(t._s(t.session.remote_addr))])]),t._v(" "),s("el-col",[s("span",{staticClass:"item-label"},[t._v(t._s(t.$t("SessionState"))+"：")]),t._v(" "),s("span",{staticClass:"item-value cur-color",style:{background:t.session.is_finished?"#ed5565":"#1ab394"}})])],1)],1),t._v(" "),s("el-divider"),t._v(" "),t.isAuditRoute?t._e():s("div",{staticClass:"bottom-btn"},[s("el-button",{attrs:{disabled:!t.session.can_terminate,size:"small",type:"danger"},on:{click:t.onConnect}},[t._v("\n      "+t._s(t.$t("Terminate"))+"\n    ")]),t._v(" "),s("el-button",{attrs:{disabled:!t.supportedLock,size:"small",type:"warning"},on:{click:t.onToggleLock}},[t.session.is_locked?[t._v("\n        "+t._s(t.$t("Resume"))+"\n      ")]:[t._v("\n        "+t._s(t.$t("Pause"))+"\n      ")]],2),t._v(" "),s("el-button",{attrs:{disabled:!t.session.can_join,size:"small",type:"primary"},on:{click:t.onMonitor}},[t._v("\n      "+t._s(t.$t("Monitor"))+"\n    ")])],1)],1):t._e()},I=[],O=s("ac6b"),T={components:{IBox:l["a"]},props:{object:{type:Object,default:function(){}}},data:function(){return{session:{},curTimer:null,loading:!1,supportedLock:!1}},computed:{isAuditRoute:function(){return"AuditTicketList"===this.$route.name}},created:function(){"approved"===this.object.state.value&&"login_asset_confirm"===this.object.type.value&&this.init()},beforeDestroy:function(){clearTimeout(this.curTimer),this.curTimer=null},methods:{init:function(){var t=this;this.loading=!0;var e="/api/v1/tickets/tickets/".concat(this.object.id,"/session/");this.$axios({url:e,method:"get",disableFlashErrorMsg:!0}).then((function(e){t.session=e||{};var s=e["terminal"]["type"],a="normal"===e["type"]["value"];t.supportedLock=Object(O["a"])(s)&&a})).catch((function(e){t.curTimer=setTimeout((function(){t.init()}),1400),t.$log.debug("error",e)})).finally((function(){t.loading=!1}))},onConnect:function(){var t=this,e="/api/v1/terminal/tasks/kill-session-for-ticket/",s=[this.session.id]||!1;this.$axios.post(e,s).then((function(e){t.$message.success(t.$tc("TerminateTaskSendSuccessMsg")),t.curTimer=setTimeout((function(){t.init()}),5e4)})).catch((function(e){t.$message.error(e)}))},onMonitor:function(){var t="/luna/monitor/".concat(this.session.id,"?ticket_id=").concat(this.object.id);window.open(t,"_blank","height=600, width=850, top=400, left=400, toolbar=no, menubar=no, scrollbars=no, location=no, status=no")},onToggleLock:function(){var t=this,e="/api/v1/terminal/tasks/toggle-lock-session-for-ticket/",s=this.session.is_locked?"unlock_session":"lock_session",a={session_id:this.session.id,task_name:s},i=this.$tc("ResumeTaskSendSuccessMsg"),n=this.$tc("PauseTaskSendSuccessMsg"),o=this.session.is_locked?i:n;this.$axios.post(e,a).then((function(e){t.$message.success(o),t.session.is_locked=!t.session.is_locked})).catch((function(e){t.$message.error(e)}))}}},R=T,M=(s("970f"),Object(d["a"])(R,D,I,!1,null,"31a88649",null)),L=M.exports,P={name:"GenericTicketDetail",components:{Steps:A,Comments:k,Details:m,Session:L},props:{object:{type:Object,default:function(){return{}}},specialCardItems:{type:Array,default:function(){return[]}},detailCardItems:{type:Array,default:null},assignedCardItems:{type:Array,default:function(){return[]}}},data:function(){return{statusMap:{pending:"warning",approved:"success",rejected:"danger",closed:"info",reopen:"warning"}}},computed:{iDetailCardItems:function(){var t=this,e=this.$createElement;if(this.detailCardItems)return this.detailCardItems;var s=this.object;return[{key:this.$tc("Number"),value:s["serial_num"]},{key:this.$tc("Status"),value:s.state.value,formatter:function(s,a){var i=t.statusMap[a];return e("el-tag",{attrs:{type:i,size:"small"}},[t.object.state.label])}},{key:this.$tc("Type"),value:s.type.label},{key:this.$tc("User"),value:s.rel_snapshot.applicant},{key:this.$tc("OrgName"),value:s.org_name},{key:this.$tc("DateCreated"),value:s.date_created},{key:this.$tc("Comment"),value:s.comment}]}}},B=P,z=Object(d["a"])(B,a,i,!1,null,null,null);e["a"]=z.exports},bc1b:function(t,e,s){},e377:function(t,e,s){"use strict";s("bc1b")},eb91:function(t,e,s){"use strict";s("1835")},fa8d:function(t,e,s){"use strict";s("8463")},fc65:function(t,e,s){}}]);
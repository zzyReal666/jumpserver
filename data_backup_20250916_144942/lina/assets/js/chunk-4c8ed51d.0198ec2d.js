(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c8ed51d"],{"1d4f":function(e,t,a){"use strict";a("35c5")},"243c":function(e,t,a){"use strict";a("d3b7")},"35c5":function(e,t,a){},"5ebc":function(e,t,a){"use strict";var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{staticClass:"account-content",nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-radio-group",{on:{input:e.handleRadioChanged},model:{value:e.realRadioSelected,callback:function(t){e.realRadioSelected=t},expression:"realRadioSelected"}},e._l(e.realChoices,(function(t){return a("el-radio",{key:t.label,attrs:{disabled:t.disabled,label:t.value}},[e._v("\n        "+e._s(t.label)+"\n        "),t.tip?a("el-tooltip",{attrs:{content:t.tip,"open-delay":500,placement:"top"}},[a("i",{staticClass:"fa fa-question-circle-o"})]):e._e()],1)})),1),e._v(" "),e.showSpecZone?a("div",{staticClass:"spec-accounts spec-zone"},[a("div",{staticClass:"group-title"},[e._v(e._s(e.$t("SpecAccount")))]),e._v(" "),a("TagInput",{attrs:{autocomplete:e.autocomplete,"tag-type":e.getTagType},on:{change:e.handleTagChange},model:{value:e.specAccountsInput,callback:function(t){e.specAccountsInput=t},expression:"specAccountsInput"}}),e._v(" "),e.showAddTemplate?a("span",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.showTemplateDialog=!0}}},[e._v("\n          "+e._s(e.$t("TemplateAdd"))+"\n        ")]),e._v(" "),a("span",{staticClass:"help-block"},[e._v("\n          "+e._s(e.addTemplateHelpText)+"\n        ")])],1):e._e()],1):e._e(),e._v(" "),e.enableVirtualAccount?a("div",{staticClass:"spec-zone virtual-choices"},[a("el-checkbox",{on:{change:e.handleVirtualChecked},model:{value:e.virtualChecked,callback:function(t){e.virtualChecked=t},expression:"virtualChecked"}},[e._v("\n        "+e._s(e.virtualAccount.label)+"\n      ")]),e._v(" "),e.virtualChecked?a("el-select",{attrs:{multiple:!0,placeholder:e.$t("SelectVirtualAccount")},on:{change:e.handleVirtualChecked},model:{value:e.virtualSelected,callback:function(t){e.virtualSelected=t},expression:"virtualSelected"}},e._l(e.virtualAccounts,(function(t){return a("el-option",{key:t.label,attrs:{label:t.label,value:t.value}},[e._v("\n          "+e._s(t.label)+"\n          "),a("el-tooltip",{attrs:{content:t.tip,"open-delay":500,placement:"top"}},[a("i",{staticClass:"fa fa-question-circle-o"})])],1)})),1):e._e()],1):e._e()],1),e._v(" "),e.showTemplateDialog?a("Dialog",{attrs:{title:e.$tc("AccountTemplate"),visible:e.showTemplateDialog},on:{"update:visible":function(t){e.showTemplateDialog=t},cancel:e.handleAccountTemplateCancel,confirm:e.handleAccountTemplateConfirm}},[a("ListTable",e._b({ref:"templateTable"},"ListTable",e.accountTemplateTable,!1))],1):e._e()],1)},n=[],i=a("75fc"),c=(a("f559"),a("6762"),a("2fdb"),a("57e7"),a("7618")),r=(a("6d67"),a("d25f"),a("f823")),o=a("992f"),l=a("af7d"),u=a("9039"),p={components:{TagInput:r["k"],ListTable:l["a"],Dialog:u["a"]},props:{value:{type:[Array,String],default:function(){return[]}},assets:{type:[Array],default:function(){return[]}},nodes:{type:[Array],default:function(){return[]}},oid:{type:String,default:""},showAddTemplate:{type:Boolean,default:!0},enableVirtualAccount:{type:Boolean,default:!0},addTemplateHelpText:{type:String,default:function(){return this.$t("TemplateHelpText")}}},data:function(){var e=this,t=this,a="@VIRTUAL";return{ALL:o["b"],SPEC:o["j"],VIRTUAL:a,EXCLUDE:o["h"],showTemplateDialog:!1,realRadioSelected:this.ALL,realChoices:o["m"],virtualChecked:!1,virtualSelected:[],output:[],excludeAccountsInput:[],virtualAccounts:o["o"],virtualAccountsNames:[o["f"],o["i"],o["c"]],specAccountsInput:[],specAccountsTemplate:[],showSpecZone:!1,getTagType:function(e){return t.specAccountsTemplate.filter((function(t){return t.username===e})).length>0?"primary":"info"},showExcludeZone:!1,accountTemplateTable:o["l"],autocomplete:function(a,s){var n={username:a,assets:e.assets.slice(0,20),nodes:e.nodes.slice(0,20).map((function(e){return"object"===Object(c["a"])(e)?e.pk:e}))};e.$axios.post("/api/v1/accounts/accounts/username-suggestions/",n,{params:{oid:e.oid}}).then((function(e){e||(e=[]);var a=e.filter((function(e){return-1===t.value.indexOf(e)})).map((function(e){return{value:e,label:e}}));s(a)}))}}},computed:{virtualAccount:function(){return o["n"]}},watch:{realRadioSelected:{handler:function(e){this.showSpecZone=e===this.SPEC,this.showExcludeZone=e===this.EXCLUDE},sync:!0}},mounted:function(){this.initDefaultChoice()},methods:{getVirtualChoices:function(e){return this.virtualAccounts.filter((function(t){return e.includes(t.value)})).map((function(e){return e.value}))},getExcludeChoices:function(e){return e.filter((function(e){return e.startsWith("!")})).map((function(e){return e.substring(1)}))},getSpecValues:function(e){return e.filter((function(e){return!e.startsWith("@")&&!e.startsWith("!")}))},initDefaultChoice:function(){var e=this.value||[],t=this.getSpecValues(e),a=e.includes(this.ALL);a?this.realRadioSelected=this.ALL:t.length>0||e.includes(this.SPEC)?(this.realRadioSelected=this.SPEC,this.specAccountsInput=t):this.realRadioSelected=o["g"];var s=this.getVirtualChoices(this.value);s.length>0&&(this.virtualChecked=!0,this.virtualSelected=s)},handleAccountTemplateCancel:function(){this.showTemplateDialog=!1},handleAccountTemplateConfirm:function(){var e=this;this.specAccountsTemplate=this.$refs.templateTable.selectedRows;var t=this.specAccountsTemplate.map((function(e){return e.username}));this.specAccountsInput=this.specAccountsInput.filter((function(e){return!t.includes(e)})).concat(t),this.outputValue(),setTimeout((function(){e.showTemplateDialog=!1,e.outputValue()}),100)},handleVirtualChecked:function(e,t){this.outputValue()},handleRadioChanged:function(e){this.outputValue()},handleTagChange:function(){this.outputValue()},outputValue:function(){var e=[];if(this.realRadioSelected===this.ALL)e=[this.ALL];else if(this.realRadioSelected===this.SPEC&&this.showSpecZone){var t=this.specAccountsTemplate.map((function(e){return"%".concat(e.id)}));e=[this.realRadioSelected].concat(Object(i["a"])(this.specAccountsInput),Object(i["a"])(t))}else this.realRadioSelected===o["g"]&&(e=[]);this.virtualChecked&&(e=[].concat(Object(i["a"])(e),Object(i["a"])(this.virtualSelected))),this.$log.debug("choicesSelected",e),this.$emit("input",e),this.$emit("change",e)}}},d=p,m=(a("243c"),a("2877")),h=Object(m["a"])(d,s,n,!1,null,"202e51b6",null);t["a"]=h.exports},"685f":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("GenericDetailPage",e._g(e._b({attrs:{"active-menu":e.config.activeMenu,object:e.ticket},on:{"update:activeMenu":function(t){return e.$set(e.config,"activeMenu",t)},"update:active-menu":function(t){return e.$set(e.config,"activeMenu",t)},"update:object":function(t){e.ticket=t}}},"GenericDetailPage",e.config,!1),e.$listeners),[a(e.config.activeMenu,{tag:"component",attrs:{object:e.ticket}})],1)},n=[],i=a("cd4a"),c=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("GenericTicketDetail",{attrs:{approve:e.handleApprove,"assigned-card-items":e.assignedCardItems,close:e.handleClose,object:e.object,reject:e.handleReject,"special-card-items":e.specialCardItems}},[e.hasActionPerm&&"closed"!==e.object.status.value?a("IBox",{staticClass:"box"},[a("div",{staticClass:"clearfix ibox-title",attrs:{slot:"header"},slot:"header"},[a("i",{staticClass:"fa fa-edit"}),e._v(" "+e._s(e.$tc("Actions"))+"\n    ")]),e._v(" "),[a("el-form",{ref:"requestForm",staticClass:"assets",attrs:{model:e.requestForm,"label-position":"left","label-width":"140px"}},[a("el-form-item",{attrs:{label:e.$tc("Node")}},[a("Select2",e._b({staticStyle:{width:"50% !important"},model:{value:e.requestForm.nodes,callback:function(t){e.$set(e.requestForm,"nodes",t)},expression:"requestForm.nodes"}},"Select2",e.nodeSelect2,!1))],1),e._v(" "),a("el-form-item",{attrs:{label:e.$tc("Asset")}},[a("Select2",e._b({staticStyle:{width:"50% !important"},model:{value:e.requestForm.assets,callback:function(t){e.$set(e.requestForm,"assets",t)},expression:"requestForm.assets"}},"Select2",e.assetSelect2,!1))],1),e._v(" "),a("el-form-item",{attrs:{label:e.$tc("Account"),rules:e.isRequired}},[a("AccountFormatter",{staticStyle:{width:"50% !important"},attrs:{assets:e.requestForm.assets,nodes:e.requestForm.nodes,oid:e.requestForm.oid,"show-add-template":!1},model:{value:e.requestForm.accounts,callback:function(t){e.$set(e.requestForm,"accounts",t)},expression:"requestForm.accounts"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$tc("DateStart"),required:""}},[a("el-date-picker",{attrs:{type:"datetime"},model:{value:e.requestForm.apply_date_start,callback:function(t){e.$set(e.requestForm,"apply_date_start",t)},expression:"requestForm.apply_date_start"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$tc("DateExpired"),required:""}},[a("el-date-picker",{attrs:{type:"datetime"},model:{value:e.requestForm.apply_date_expired,callback:function(t){e.$set(e.requestForm,"apply_date_expired",t)},expression:"requestForm.apply_date_expired"}})],1),e._v(" "),a("el-form-item",{attrs:{label:e.$tc("Action")}},[a("BasicTree",{staticStyle:{width:"100%"},attrs:{tree:e.treeNodes},model:{value:e.requestForm.actions,callback:function(t){e.$set(e.requestForm,"actions",t)},expression:"requestForm.actions"}})],1)],1)]],2):e._e()],1)},r=[],o=(a("d25f"),a("57e7"),a("7f7f"),a("6d67"),a("3f95")),l=a("0218"),u=a("9cdc"),p=a("5ebc"),d=a("49bd"),m=a("4703"),h=a("e9f9"),f=a("992f"),v={name:"",components:{GenericTicketDetail:u["a"],IBox:h["a"],Select2:d["a"],AccountFormatter:p["a"],BasicTree:m["a"]},props:{object:{type:Object,default:function(){return{}}}},data:function(){var e,t;return{treeNodes:l["g"],statusMap:"open"===this.object.status.value?l["f"]["pending"]:l["f"][this.object.state.value],requestForm:{nodes:null===(e=this.object.apply_nodes)||void 0===e?void 0:e.map((function(e){return e.id})),assets:null===(t=this.object.apply_assets)||void 0===t?void 0:t.map((function(e){return e.id})),accounts:this.object.apply_accounts,actions:this.object.apply_actions,oid:this.object.org_id,apply_date_expired:this.object.apply_date_expired,apply_date_start:this.object.apply_date_start},nodeSelect2:{multiple:!0,value:this.object.apply_nodes,ajax:{url:function(e){var t=e.org_id;return"/api/v1/assets/nodes/?oid=".concat(t,"&protocol__in=rdp,vnc,ssh,telnet")}(this.object),transformOption:function(e){return{label:"".concat(e.full_value),value:e.id}}}},assetSelect2:{multiple:!0,value:this.object.apply_assets,ajax:{url:function(e){var t=e.org_id;return"/api/v1/assets/assets/?oid=".concat(t,"&protocol__in=rdp,vnc,ssh,telnet")}(this.object),transformOption:function(e){return{label:"".concat(e.name,"(").concat(e.address,")"),value:e.id}}}}}},computed:{isRequired:function(){return this.object.approval_step.value===this.object.process_map.length?[{required:!0}]:[{required:!1}]},specialCardItems:function(){var e=this.object;return[{key:this.$tc("Node"),value:e.apply_nodes.map((function(e){return e.name})).join(", ")},{key:this.$tc("Asset"),value:e.apply_assets.map((function(e){return e.name})).join(", ")},{key:this.$tc("Account"),value:e.apply_accounts.map((function(e){return f["a"][e]||e})).join(", ")},{key:this.$tc("Action"),value:e.apply_actions.map((function(e){return e.label})).join(", ")},{key:this.$tc("DateStart"),value:e.apply_date_start},{key:this.$tc("DateExpired"),value:e.apply_date_expired}]},assignedCardItems:function(){var e=this.$createElement,t=this,a=this.object;return[{key:this.$tc("PermissionName"),value:a.apply_permission_name,formatter:function(s,n){var i={name:"AssetPermissionDetail",params:{id:a.id},query:{oid:a.org_id}};return t.$hasPerm("perms.view_assetpermission")&&"closed"===a.status.value&&"approved"===a.state.value?e("router-link",{attrs:{to:i}},[n]):e("span",[n])}},{key:this.$tc("Node"),value:a.apply_nodes.map((function(e){return e.name})).join(", ")},{key:this.$tc("Asset"),value:a.apply_assets.map((function(e){return e.name})).join(", ")},{key:this.$tc("Account"),value:a.apply_accounts.map((function(e){return f["a"][e]||e})).join(", ")},{key:this.$tc("Action"),value:a.apply_actions.map((function(e){return e.label})).join(", ")},{key:this.$tc("DateStart"),value:a.apply_date_start},{key:this.$tc("DateExpired"),value:a.apply_date_expired}]},hasActionPerm:function(){var e=this.object.approval_step.value,t=this.$store.state.users.profile.id;return-1!==this.object.process_map.filter((function(t){return t.approval_level===e}))[0].assignees.indexOf(t)}},methods:{formatTime:function(e){return Object(o["a"])(Object(o["b"])(e))},toSafeLocalDateStr:function(e){return Object(o["i"])(e)},reloadPage:function(){window.location.reload()},handleApprove:function(){var e=this,t=this.requestForm.nodes,a=this.requestForm.assets,s=this.requestForm.accounts;if(this.object.approval_step.value===this.object.process_map.length){if(0===a.length&&0===t.length)return this.$message.error(this.$tc("SelectAtLeastOneAssetOrNodeErrMsg"));if(0===s.length)return this.$message.error(this.$tc("RequiredSystemUserErrMsg"))}this.$axios.patch("/api/v1/tickets/apply-asset-tickets/".concat(this.object.id,"/approve/"),{apply_nodes:t||[],apply_assets:a||[],apply_accounts:s||[],org_id:this.object.org_id,apply_actions:this.requestForm.actions,apply_date_start:this.requestForm.apply_date_start,apply_date_expired:this.requestForm.apply_date_expired}).then((function(){e.$message.success(e.$tc("UpdateSuccessMsg")),e.reloadPage()})).catch((function(){e.$message.success(e.$tc("UpdateErrorMsg"))}))},handleClose:function(){var e=this,t="/api/v1/tickets/apply-asset-tickets/".concat(this.object.id,"/close/");this.$axios.put(t).then((function(t){return e.reloadPage()})).catch((function(t){return e.$message.error(t)}))},handleReject:function(){var e=this,t="/api/v1/tickets/apply-asset-tickets/".concat(this.object.id,"/reject/");this.$axios.put(t).then((function(t){return e.reloadPage()})).catch((function(t){return e.$message.error(t)}))}}},b=v,_=(a("1d4f"),a("2877")),A=Object(_["a"])(b,c,r,!1,null,"231833cb",null),g=A.exports,y={components:{GenericDetailPage:i["d"],TicketDetail:g,TabPage:i["l"]},data:function(){return{ticket:{title:"",user_display:"",type_display:"",status:"",processor:"",date_created:""},config:{activeMenu:"TicketDetail",url:"",submenu:[{title:this.$t("TicketDetail"),name:"TicketDetail"}],actions:{detailApiUrl:"/api/v1/tickets/apply-asset-tickets/".concat(this.$route.params.id,"/")},getObjectName:this.getObjectName,hasRightSide:!1}}},methods:{getObjectName:function(){return this.ticket.title}}},j=y,k=Object(_["a"])(j,s,n,!1,null,"93ceed64",null);t["default"]=k.exports},7:function(e,t){},"992f":function(e,t,a){"use strict";a.d(t,"k",(function(){return r})),a.d(t,"e",(function(){return o})),a.d(t,"d",(function(){return l})),a.d(t,"b",(function(){return u})),a.d(t,"j",(function(){return p})),a.d(t,"h",(function(){return d})),a.d(t,"i",(function(){return m})),a.d(t,"f",(function(){return h})),a.d(t,"c",(function(){return f})),a.d(t,"g",(function(){return v})),a.d(t,"a",(function(){return b})),a.d(t,"n",(function(){return _})),a.d(t,"m",(function(){return A})),a.d(t,"o",(function(){return g})),a.d(t,"l",(function(){return y}));var s=a("bd86"),n=(a("a481"),a("6d67"),a("0692")),i=a("b318"),c=a("62f3"),r=[{label:n["a"].t("Name"),value:"name"},{label:n["a"].t("Username"),value:"username"},{label:n["a"].t("UserGroups"),value:"user_group"},{label:n["a"].t("AssetName"),value:"asset_name"},{label:n["a"].t("AssetAddress"),value:"address"},{label:n["a"].t("Account"),value:"accounts"},{label:n["a"].t("Valid"),value:"is_valid",children:[{value:"1",label:n["a"].t("Yes")},{value:"0",label:n["a"].t("No")}]},{label:n["a"].t("Effective"),value:"is_effective",children:[{value:"1",label:n["a"].t("Yes")},{value:"0",label:n["a"].t("No")}]},{label:n["a"].t("FromTicket"),value:"from_ticket",children:[{value:"1",label:n["a"].t("Yes")},{value:"0",label:n["a"].t("No")}]}],o={name:{formatter:c["a"],minWidth:"120px",formatterArgs:{route:"AssetPermissionDetail",drawer:!0,routeQuery:{tab:"Basic"}}},action:{label:n["a"].t("Action"),formatter:function(e){return 6===e.actions.length?n["a"].t("All"):e.actions.map((function(e){return e.label.replace(/ \([^)]*\)/,"")})).join(",")}},is_expired:{formatterArgs:{showFalse:!1}},from_ticket:{width:"130px",formatterArgs:{showFalse:!1}},users_amount:{width:80,formatter:i["a"],formatterArgs:{async:!0,route:"AssetPermissionDetail",drawer:!0,routeQuery:{tab:"AssetPermissionUser"}}},user_groups_amount:{width:80,formatter:i["a"],formatterArgs:{async:!0,drawer:!0,route:"AssetPermissionDetail",routeQuery:{tab:"AssetPermissionUser"}}},assets_amount:{width:80,formatter:i["a"],formatterArgs:{async:!0,drawer:!0,route:"AssetPermissionDetail",routeQuery:{tab:"AssetPermissionAsset"}}},nodes_amount:{width:80,formatter:i["a"],formatterArgs:{async:!0,drawer:!0,route:"AssetPermissionDetail",routeQuery:{tab:"AssetPermissionAsset"}}},accounts:{width:80,formatter:i["a"],formatterArgs:{cellValueToRemove:["@SPEC"],drawer:!0,getItem:function(e){if("@SPEC"!==e)return b[e]||e},route:"AssetPermissionDetail",routeQuery:{tab:"AssetPermissionAccount"}}},actions:{formatterArgs:{updateRoute:"AssetPermissionUpdate",cloneRoute:"AssetPermissionCreate",performDelete:function(e){var t=e.row,a=(e.col,t.id),s="/api/v1/perms/asset-permissions/".concat(a,"/");return this.$axios.delete(s)}}}},l=[].concat(r,[{label:n["a"].t("NodeSearchStrategy"),value:"all",children:[{value:"0",label:n["a"].t("OnlySearchCurrentNodePerm")},{value:"1",label:n["a"].t("SearchAncestorNodePerm")}]}]),u="@ALL",p="@SPEC",d="@NOT",m="@USER",h="@INPUT",f="@ANON",v="@NONE",b=Object(s["a"])(Object(s["a"])(Object(s["a"])(Object(s["a"])(Object(s["a"])(Object(s["a"])(Object(s["a"])({},u,n["a"].t("AllAccounts")),p,n["a"].t("SpecAccount")),d,n["a"].t("ExcludeAccount")),v,n["a"].t("None")),m,n["a"].t("SameAccount")),h,n["a"].t("ManualAccount")),f,n["a"].t("AnonymousAccount")),_={label:n["a"].t("VirtualAccounts"),value:"@VIRTUAL",tip:n["a"].t("VirtualAccountHelpMsg")},A=[{label:b[u],value:u,tip:n["a"].t("AllAccountTip")},{label:b[p],value:p,tip:n["a"].t("SpecAccountTip")},{label:b[v],value:v}],g=[{label:b[h],value:h,tip:n["a"].t("ManualAccountTip")},{label:b[m],value:m,tip:n["a"].t("SameAccountTip")},{label:b[f],value:f,tip:n["a"].t("AnonymousAccountTip")}],y={tableConfig:{url:"/api/v1/accounts/account-templates/",columns:["name","username","has_secret","comment","date_created","date_updated"],columnsMeta:{name:{formatterArgs:{openInNewPage:!0,getRoute:function(e){var t=e.row;e.col,e.cellValue;return{name:"AccountTemplateDetail",params:{id:t.id}}}}},has_secret:{formatterArgs:{showFalse:!1}},actions:{has:!1}}},headerActions:{hasLeftActions:!1,hasImport:!1,hasExport:!1}}},d3b7:function(e,t,a){}}]);
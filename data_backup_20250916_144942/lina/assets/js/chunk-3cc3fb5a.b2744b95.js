(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3cc3fb5a"],{"49c1":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("TabPage",{attrs:{"active-menu":e.activeMenu,submenu:e.submenu},on:{"update:activeMenu":function(t){e.activeMenu=t},"update:active-menu":function(t){e.activeMenu=t}}},[a(e.activeMenu,{tag:"component"})],1)},i=[],o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("BaseJob")],1)},r=[],s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("GenericListTable",{ref:"ListTable",attrs:{"header-actions":e.headerActions,"create-drawer":e.createDrawer,"detail-drawer":e.detailDrawer,"table-config":e.tableConfig}}),e._v(" "),e.showJobRunDialog?a("JobRunDialog",{attrs:{item:e.item,visible:e.showJobRunDialog},on:{"update:visible":function(t){e.showJobRunDialog=t},submit:e.runJob}}):e._e(),e._v(" "),e.showVariableDialog?a("SetVariableDialog",{attrs:{"form-data":e.formData,"query-param":"job="+e.item.id,visible:e.showVariableDialog},on:{"update:visible":function(t){e.showVariableDialog=t},submit:e.runJobWithParams}}):e._e()],1)},u=[],l=(a("6d67"),a("ac6a"),a("456d"),function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.iVisible&&e.ready?a("Dialog",{attrs:{"show-cancel":!1,"show-confirm":!1,title:e.$tc("RunJob"),visible:e.iVisible,top:"1vh",width:"50%"},on:{"update:visible":function(t){e.iVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"140px"}},[e._l(e.vars,(function(t,n,i){return a("el-form-item",{key:i,attrs:{label:t.label}},["select"===t.type?a("div",[a("el-select",{model:{value:e.form[n],callback:function(t){e.$set(e.form,n,t)},expression:"form[key]"}},e._l(t.options,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1):a("div",[a("el-input",{model:{value:e.form[n],callback:function(t){e.$set(e.form,n,t)},expression:"form[key]"}})],1)])})),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.onSubmit}},[e._v("执行")])],1)],2)],1):e._e()}),c=[],m=a("9039"),f={components:{Dialog:m["a"]},props:{visible:{type:Boolean,default:!1},item:{type:Object,default:function(){return{}}}},data:function(){return{ready:!1,vars:{},form:{}}},computed:{iVisible:{set:function(e){this.$emit("update:visible",e)},get:function(){return this.visible}}},mounted:function(){this.vars=JSON.parse(this.item.parameters_define);for(var e=0,t=Object.keys(this.vars);e<t.length;e++){var a=t[e];this.$set(this.form,a,this.vars[a].default||"")}this.ready=!0},methods:{onSubmit:function(){this.$emit("submit",this.item,JSON.stringify(this.form)),this.iVisible=!1}}},b=f,d=(a("fd21"),a("2877")),h=Object(d["a"])(b,l,c,!1,null,"63b7bc03",null),p=h.exports,v=a("ae05"),_=a("6350"),y=a("ac6b"),g=a("53f7"),w={components:{GenericListTable:v["a"],JobRunDialog:p,SetVariableDialog:_["a"]},props:{type:{type:String,default:"adhoc"}},data:function(){var e=this,t=this;return{createDrawer:function(){return Promise.all([a.e("chunk-commons"),a.e("chunk-55b557da"),a.e("chunk-4367c372"),a.e("chunk-0e71efe5"),a.e("chunk-39bc190f")]).then(a.bind(null,"9519"))},detailDrawer:function(){return Promise.all([a.e("chunk-commons"),a.e("chunk-55b557da"),a.e("chunk-4367c372"),a.e("chunk-0e71efe5"),a.e("chunk-4fcda924")]).then(a.bind(null,"766c"))},item:{},tableConfig:{url:"/api/v1/ops/jobs/?type=".concat(this.type),columnsShow:{min:["name","actions"],default:["name","type","asset_amount","average_time_cost","summary","date_last_run","actions"]},columns:["name","type","summary","average_time_cost","asset_amount","is_periodic","periodic_display","date_last_run","comment","date_updated","date_created","actions"],columnsMeta:{name:{width:"140px",formatter:g["i"],formatterArgs:{can:!0,getRoute:function(e){var t=e.row;return{name:"JobDetail",params:{id:t.id}}}}},type:{width:"96px",formatter:function(e){return e.type.label}},comment:{width:"240px"},summary:{label:this.$t("Summary"),formatter:function(e){return e.summary["success"]+"/"+e.summary["total"]}},average_time_cost:{formatter:function(e){return e.average_time_cost.toFixed(2)+"s"}},asset_amount:{label:this.$t("AssetsOfNumber"),formatter:function(e){return e.assets.length}},date_last_run:{width:"140px",formatter:g["g"]},actions:{formatter:g["c"],formatterArgs:{hasUpdate:!0,canUpdate:this.$hasPerm("ops.change_job")&&!this.$store.getters.currentOrgIsRoot,updateRoute:"JobUpdate",onUpdate:function(a){var n=a.row,i=a.col;t.$refs.ListTable.onUpdate({row:n,col:i,query:{_type:e.type}})},hasDelete:!0,canDelete:this.$hasPerm("ops.delete_job"),hasClone:!1,extraActions:[{title:this.$t("Run"),name:"run",order:5,type:"primary",can:this.$hasPerm("ops.add_jobexecution")&&!this.$store.getters.currentOrgIsRoot,callback:function(t){var a,n=t.row;if(e.item=n,null!==n&&void 0!==n&&n.use_parameter_define&&null!==n&&void 0!==n&&n.parameters_define){var i=JSON.parse(n.parameters_define);Object.keys(i).length>0&&(e.showJobRunDialog=!0)}else null!==n&&void 0!==n&&null!==(a=n.variable)&&void 0!==a&&a.length?e.showVariableDialog=!0:e.runJob(n)}}]}}}},headerActions:{onCreate:function(){t.$refs.ListTable.onCreate({query:{_type:e.type}})},hasRefresh:!0,hasExport:!1,hasImport:!1},showJobRunDialog:!1,showVariableDialog:!1}},computed:{formData:function(){return this.item.variable.map((function(e){return e.form_data}))}},methods:{runJob:function(e,t){var a=this;this.$axios.post("/api/v1/ops/job-executions/",{job:e.id,parameters:t}).then((function(e){a.showVariableDialog=!1,Object(y["k"])(e.task_id)}))},runJobWithParams:function(e){this.runJob(this.item,e)}}},D=w,$=Object(d["a"])(D,s,u,!1,null,null,null),k=$.exports,J={name:"Adhoc",components:{BaseJob:k}},x=J,V=Object(d["a"])(x,o,r,!1,null,null,null),P=V.exports,j=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("BaseJob",{attrs:{type:"playbook"}})],1)},A=[],O={name:"PlayBook",components:{BaseJob:k}},S=O,R=Object(d["a"])(S,j,A,!1,null,null,null),C=R.exports,T=a("9b8c"),B={components:{Adhoc:P,TabPage:T["a"],Playbook:C},data:function(){var e=this;return{activeMenu:"Adhoc",submenu:[{title:this.$t("AdhocManage"),name:"Adhoc",hidden:function(){return!e.$hasPerm("ops.view_adhoc")}},{title:this.$t("PlaybookManage"),name:"Playbook",hidden:function(){return!e.$hasPerm("ops.view_playbook")}}]}}},M=B,q=Object(d["a"])(M,n,i,!1,null,null,null);t["default"]=q.exports},6350:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.iVisible?a("Dialog",{attrs:{"destroy-on-close":!0,"show-cancel":!1,"show-confirm":!1,title:e.$tc("setVariable"),visible:e.iVisible,width:"800px"},on:{"update:visible":function(t){e.iVisible=t}}},[a("VariableSetForm",{attrs:{"form-data":e.formData,"query-param":e.queryParam},on:{confirm:e.handleConfirm}})],1):e._e()},i=[],o=a("9039"),r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("AutoDataForm",e._b({ref:"AutoDataForm",staticClass:"variable-set",attrs:{"submit-btn-text":e.submitBtnText,fields:e.fields},on:{submit:e.confirm}},"AutoDataForm",e.$data,!1))},s=[],u=(a("6d67"),a("c75f")),l={name:"VariableSetForm",components:{AutoDataForm:u["a"]},props:{formData:{type:Array,default:function(){return[]}},queryParam:{type:String,default:""}},data:function(){return{submitBtnText:this.$t("Confirm"),url:"/api/v1/ops/variables/form-data/?t=".concat((new Date).getTime(),"&")+this.queryParam,form:{},hasSaveContinue:!1,method:"get",hasReset:!1}},computed:{fields:function(){return[["",this.formData.map((function(e){return e.var_name}))]]}},methods:{confirm:function(e){this.$emit("confirm",e)}}},c=l,m=(a("8fd3"),a("2877")),f=Object(m["a"])(c,r,s,!1,null,"0256369a",null),b=f.exports,d={name:"SetVariableDialog",components:{Dialog:o["a"],VariableSetForm:b},props:{visible:{type:Boolean,default:!1},formData:{type:Array,default:function(){return[]}},queryParam:{type:String,default:""}},data:function(){return{}},computed:{iVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{handleConfirm:function(e){this.$emit("submit",e)}}},h=d,p=Object(m["a"])(h,n,i,!1,null,"187f5500",null);t["a"]=p.exports},8474:function(e,t,a){},"8fd3":function(e,t,a){"use strict";a("a790")},a790:function(e,t,a){},fd21:function(e,t,a){"use strict";a("8474")}}]);
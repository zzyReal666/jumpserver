(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4f216562"],{"243c":function(e,t,a){"use strict";a("d3b7")},"3cae":function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.loading?e._e():a("GenericCreateUpdatePage",e._b({attrs:{"create-success-next-route":e.createSuccessNextRoute,"perform-submit":e.performSubmit}},"GenericCreateUpdatePage",e.$data,!1))},s=[],l=(a("1c01"),a("58b2"),a("8e6e"),a("d25f"),a("bd86")),i=(a("6762"),a("2fdb"),a("456d"),a("ac6a"),a("f3e2"),a("768b")),c=(a("6d67"),a("7f7f"),a("8ea5"),a("cd4a")),o=a("5ebc"),r=a("49bd"),u=a("3f95"),p=a("2f62"),d=a("4360");function f(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function h(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?f(Object(a),!0).forEach((function(t){Object(l["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var m={components:{GenericCreateUpdatePage:c["c"]},data:function(){var e,t=this,a=new Date,n=d["a"].getters.publicSettings["TICKET_AUTHORIZE_DEFAULT_TIME"],s=d["a"].getters.publicSettings["TICKET_AUTHORIZE_DEFAULT_TIME_UNIT"],l="hour"===s?24:1,c=Object(u["f"])(n/l,new Date).toISOString(),p=a.toISOString();return{hasDetailInMsg:!1,loading:!0,initial:{ips_or_not:!0,apply_date_expired:c,apply_date_start:p,apply_assets:[],org_id:"",apply_actions:[this.$t("All")]},fields:[[this.$t("Basic"),["title","org_id"]],[this.$t("RequestPerm"),["apply_nodes","apply_assets","apply_accounts","apply_actions","apply_date_start","apply_date_expired"]],[this.$t("Other"),["comment"]]],fieldsMeta:{title:{el:{type:"input"}},type:{hidden:function(){return!0},el:{disabled:!0}},apply_actions:{label:this.$t("Actions"),helpText:this.$t("ActionsTips")},apply_nodes:{label:this.$t("Node"),component:r["a"],el:{value:[],ajax:{url:"",transformOption:function(e){return{label:"".concat(e.full_value),value:e.id}}},clearable:!0}},apply_assets:{type:"assetSelect",label:this.$t("Asset"),component:r["a"],el:{value:[],ajax:{url:"",transformOption:function(e){return{label:e.name+"("+e.address+")",value:e.id}}}}},apply_accounts:{component:o["a"],el:{nodes:[],assets:[],showAddTemplate:!1},hidden:function(e){t.fieldsMeta.apply_accounts.el.assets=e.apply_assets,t.fieldsMeta.apply_accounts.el.nodes=e.apply_nodes}},org_id:{label:this.$t("Organization"),component:r["a"],el:{multiple:!1,options:null===(e=this.$store.state.users.noRootWorkbenchOrgs)||void 0===e?void 0:e.map((function(e){return{label:e.name,value:e.id}}))},hidden:function(e){var a=t.fieldsMeta;a.apply_assets.el.ajax.url="/api/v1/tickets/apply-assets/suggestions/?oid=".concat(e["org_id"]),a.apply_nodes.el.ajax.url="/api/v1/tickets/apply-nodes/suggestions/?oid=".concat(e["org_id"]),a.apply_accounts.el.oid=e["org_id"]},on:{change:function(e,t){var a=Object(i["a"])(e,1);a[0];t({apply_nodes:[],apply_assets:[],apply_system_users:[]})}}}},cleanFormValue:function(e){var t=this,a=e["apply_actions"]||[];return a.forEach((function(e,n){e===t.$t("All")&&(a[n]="all")})),Object.keys(e).forEach((function(t,a,n){["apply_accounts","apply_assets","apply_nodes"].includes(t)&&e[t].length<1&&delete e[t]})),e},url:"/api/v1/tickets/apply-asset-tickets/?state=pending",createSuccessNextRoute:{name:"MyTicketList"}}},computed:h(h({},Object(p["c"])({workbenchOrgs:function(e){return e.users.noRootWorkbenchOrgs}})),Object(p["b"])(["currentOrg"])),mounted:function(){var e=this.currentOrg.id||"",t=this.workbenchOrgs.map((function(e){return e.id}))||[];t.includes(e)?this.initial.org_id=e:this.initial.org_id=t[0],this.loading=!1},methods:{performSubmit:function(e){return this.$axios["post"]("/api/v1/tickets/apply-asset-tickets/open/",e)}}},b=m,v=a("2877"),A=Object(v["a"])(b,n,s,!1,null,"51449c54",null);t["default"]=A.exports},"5ebc":function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-form",{staticClass:"account-content",nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",[a("el-radio-group",{on:{input:e.handleRadioChanged},model:{value:e.realRadioSelected,callback:function(t){e.realRadioSelected=t},expression:"realRadioSelected"}},e._l(e.realChoices,(function(t){return a("el-radio",{key:t.label,attrs:{disabled:t.disabled,label:t.value}},[e._v("\n        "+e._s(t.label)+"\n        "),t.tip?a("el-tooltip",{attrs:{content:t.tip,"open-delay":500,placement:"top"}},[a("i",{staticClass:"fa fa-question-circle-o"})]):e._e()],1)})),1),e._v(" "),e.showSpecZone?a("div",{staticClass:"spec-accounts spec-zone"},[a("div",{staticClass:"group-title"},[e._v(e._s(e.$t("SpecAccount")))]),e._v(" "),a("TagInput",{attrs:{autocomplete:e.autocomplete,"tag-type":e.getTagType},on:{change:e.handleTagChange},model:{value:e.specAccountsInput,callback:function(t){e.specAccountsInput=t},expression:"specAccountsInput"}}),e._v(" "),e.showAddTemplate?a("span",[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){e.showTemplateDialog=!0}}},[e._v("\n          "+e._s(e.$t("TemplateAdd"))+"\n        ")]),e._v(" "),a("span",{staticClass:"help-block"},[e._v("\n          "+e._s(e.addTemplateHelpText)+"\n        ")])],1):e._e()],1):e._e(),e._v(" "),e.enableVirtualAccount?a("div",{staticClass:"spec-zone virtual-choices"},[a("el-checkbox",{on:{change:e.handleVirtualChecked},model:{value:e.virtualChecked,callback:function(t){e.virtualChecked=t},expression:"virtualChecked"}},[e._v("\n        "+e._s(e.virtualAccount.label)+"\n      ")]),e._v(" "),e.virtualChecked?a("el-select",{attrs:{multiple:!0,placeholder:e.$t("SelectVirtualAccount")},on:{change:e.handleVirtualChecked},model:{value:e.virtualSelected,callback:function(t){e.virtualSelected=t},expression:"virtualSelected"}},e._l(e.virtualAccounts,(function(t){return a("el-option",{key:t.label,attrs:{label:t.label,value:t.value}},[e._v("\n          "+e._s(t.label)+"\n          "),a("el-tooltip",{attrs:{content:t.tip,"open-delay":500,placement:"top"}},[a("i",{staticClass:"fa fa-question-circle-o"})])],1)})),1):e._e()],1):e._e()],1),e._v(" "),e.showTemplateDialog?a("Dialog",{attrs:{title:e.$tc("AccountTemplate"),visible:e.showTemplateDialog},on:{"update:visible":function(t){e.showTemplateDialog=t},cancel:e.handleAccountTemplateCancel,confirm:e.handleAccountTemplateConfirm}},[a("ListTable",e._b({ref:"templateTable"},"ListTable",e.accountTemplateTable,!1))],1):e._e()],1)},s=[],l=a("75fc"),i=(a("f559"),a("6762"),a("2fdb"),a("57e7"),a("7618")),c=(a("6d67"),a("d25f"),a("f823")),o=a("992f"),r=a("af7d"),u=a("9039"),p={components:{TagInput:c["k"],ListTable:r["a"],Dialog:u["a"]},props:{value:{type:[Array,String],default:function(){return[]}},assets:{type:[Array],default:function(){return[]}},nodes:{type:[Array],default:function(){return[]}},oid:{type:String,default:""},showAddTemplate:{type:Boolean,default:!0},enableVirtualAccount:{type:Boolean,default:!0},addTemplateHelpText:{type:String,default:function(){return this.$t("TemplateHelpText")}}},data:function(){var e=this,t=this,a="@VIRTUAL";return{ALL:o["b"],SPEC:o["j"],VIRTUAL:a,EXCLUDE:o["h"],showTemplateDialog:!1,realRadioSelected:this.ALL,realChoices:o["m"],virtualChecked:!1,virtualSelected:[],output:[],excludeAccountsInput:[],virtualAccounts:o["o"],virtualAccountsNames:[o["f"],o["i"],o["c"]],specAccountsInput:[],specAccountsTemplate:[],showSpecZone:!1,getTagType:function(e){return t.specAccountsTemplate.filter((function(t){return t.username===e})).length>0?"primary":"info"},showExcludeZone:!1,accountTemplateTable:o["l"],autocomplete:function(a,n){var s={username:a,assets:e.assets.slice(0,20),nodes:e.nodes.slice(0,20).map((function(e){return"object"===Object(i["a"])(e)?e.pk:e}))};e.$axios.post("/api/v1/accounts/accounts/username-suggestions/",s,{params:{oid:e.oid}}).then((function(e){e||(e=[]);var a=e.filter((function(e){return-1===t.value.indexOf(e)})).map((function(e){return{value:e,label:e}}));n(a)}))}}},computed:{virtualAccount:function(){return o["n"]}},watch:{realRadioSelected:{handler:function(e){this.showSpecZone=e===this.SPEC,this.showExcludeZone=e===this.EXCLUDE},sync:!0}},mounted:function(){this.initDefaultChoice()},methods:{getVirtualChoices:function(e){return this.virtualAccounts.filter((function(t){return e.includes(t.value)})).map((function(e){return e.value}))},getExcludeChoices:function(e){return e.filter((function(e){return e.startsWith("!")})).map((function(e){return e.substring(1)}))},getSpecValues:function(e){return e.filter((function(e){return!e.startsWith("@")&&!e.startsWith("!")}))},initDefaultChoice:function(){var e=this.value||[],t=this.getSpecValues(e),a=e.includes(this.ALL);a?this.realRadioSelected=this.ALL:t.length>0||e.includes(this.SPEC)?(this.realRadioSelected=this.SPEC,this.specAccountsInput=t):this.realRadioSelected=o["g"];var n=this.getVirtualChoices(this.value);n.length>0&&(this.virtualChecked=!0,this.virtualSelected=n)},handleAccountTemplateCancel:function(){this.showTemplateDialog=!1},handleAccountTemplateConfirm:function(){var e=this;this.specAccountsTemplate=this.$refs.templateTable.selectedRows;var t=this.specAccountsTemplate.map((function(e){return e.username}));this.specAccountsInput=this.specAccountsInput.filter((function(e){return!t.includes(e)})).concat(t),this.outputValue(),setTimeout((function(){e.showTemplateDialog=!1,e.outputValue()}),100)},handleVirtualChecked:function(e,t){this.outputValue()},handleRadioChanged:function(e){this.outputValue()},handleTagChange:function(){this.outputValue()},outputValue:function(){var e=[];if(this.realRadioSelected===this.ALL)e=[this.ALL];else if(this.realRadioSelected===this.SPEC&&this.showSpecZone){var t=this.specAccountsTemplate.map((function(e){return"%".concat(e.id)}));e=[this.realRadioSelected].concat(Object(l["a"])(this.specAccountsInput),Object(l["a"])(t))}else this.realRadioSelected===o["g"]&&(e=[]);this.virtualChecked&&(e=[].concat(Object(l["a"])(e),Object(l["a"])(this.virtualSelected))),this.$log.debug("choicesSelected",e),this.$emit("input",e),this.$emit("change",e)}}},d=p,f=(a("243c"),a("2877")),h=Object(f["a"])(d,n,s,!1,null,"202e51b6",null);t["a"]=h.exports},7:function(e,t){},"992f":function(e,t,a){"use strict";a.d(t,"k",(function(){return c})),a.d(t,"e",(function(){return o})),a.d(t,"d",(function(){return r})),a.d(t,"b",(function(){return u})),a.d(t,"j",(function(){return p})),a.d(t,"h",(function(){return d})),a.d(t,"i",(function(){return f})),a.d(t,"f",(function(){return h})),a.d(t,"c",(function(){return m})),a.d(t,"g",(function(){return b})),a.d(t,"a",(function(){return v})),a.d(t,"n",(function(){return A})),a.d(t,"m",(function(){return g})),a.d(t,"o",(function(){return _})),a.d(t,"l",(function(){return y}));var n=a("bd86"),s=(a("a481"),a("6d67"),a("0692")),l=a("b318"),i=a("62f3"),c=[{label:s["a"].t("Name"),value:"name"},{label:s["a"].t("Username"),value:"username"},{label:s["a"].t("UserGroups"),value:"user_group"},{label:s["a"].t("AssetName"),value:"asset_name"},{label:s["a"].t("AssetAddress"),value:"address"},{label:s["a"].t("Account"),value:"accounts"},{label:s["a"].t("Valid"),value:"is_valid",children:[{value:"1",label:s["a"].t("Yes")},{value:"0",label:s["a"].t("No")}]},{label:s["a"].t("Effective"),value:"is_effective",children:[{value:"1",label:s["a"].t("Yes")},{value:"0",label:s["a"].t("No")}]},{label:s["a"].t("FromTicket"),value:"from_ticket",children:[{value:"1",label:s["a"].t("Yes")},{value:"0",label:s["a"].t("No")}]}],o={name:{formatter:i["a"],minWidth:"120px",formatterArgs:{route:"AssetPermissionDetail",drawer:!0,routeQuery:{tab:"Basic"}}},action:{label:s["a"].t("Action"),formatter:function(e){return 6===e.actions.length?s["a"].t("All"):e.actions.map((function(e){return e.label.replace(/ \([^)]*\)/,"")})).join(",")}},is_expired:{formatterArgs:{showFalse:!1}},from_ticket:{width:"130px",formatterArgs:{showFalse:!1}},users_amount:{width:80,formatter:l["a"],formatterArgs:{async:!0,route:"AssetPermissionDetail",drawer:!0,routeQuery:{tab:"AssetPermissionUser"}}},user_groups_amount:{width:80,formatter:l["a"],formatterArgs:{async:!0,drawer:!0,route:"AssetPermissionDetail",routeQuery:{tab:"AssetPermissionUser"}}},assets_amount:{width:80,formatter:l["a"],formatterArgs:{async:!0,drawer:!0,route:"AssetPermissionDetail",routeQuery:{tab:"AssetPermissionAsset"}}},nodes_amount:{width:80,formatter:l["a"],formatterArgs:{async:!0,drawer:!0,route:"AssetPermissionDetail",routeQuery:{tab:"AssetPermissionAsset"}}},accounts:{width:80,formatter:l["a"],formatterArgs:{cellValueToRemove:["@SPEC"],drawer:!0,getItem:function(e){if("@SPEC"!==e)return v[e]||e},route:"AssetPermissionDetail",routeQuery:{tab:"AssetPermissionAccount"}}},actions:{formatterArgs:{updateRoute:"AssetPermissionUpdate",cloneRoute:"AssetPermissionCreate",performDelete:function(e){var t=e.row,a=(e.col,t.id),n="/api/v1/perms/asset-permissions/".concat(a,"/");return this.$axios.delete(n)}}}},r=[].concat(c,[{label:s["a"].t("NodeSearchStrategy"),value:"all",children:[{value:"0",label:s["a"].t("OnlySearchCurrentNodePerm")},{value:"1",label:s["a"].t("SearchAncestorNodePerm")}]}]),u="@ALL",p="@SPEC",d="@NOT",f="@USER",h="@INPUT",m="@ANON",b="@NONE",v=Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({},u,s["a"].t("AllAccounts")),p,s["a"].t("SpecAccount")),d,s["a"].t("ExcludeAccount")),b,s["a"].t("None")),f,s["a"].t("SameAccount")),h,s["a"].t("ManualAccount")),m,s["a"].t("AnonymousAccount")),A={label:s["a"].t("VirtualAccounts"),value:"@VIRTUAL",tip:s["a"].t("VirtualAccountHelpMsg")},g=[{label:v[u],value:u,tip:s["a"].t("AllAccountTip")},{label:v[p],value:p,tip:s["a"].t("SpecAccountTip")},{label:v[b],value:b}],_=[{label:v[h],value:h,tip:s["a"].t("ManualAccountTip")},{label:v[f],value:f,tip:s["a"].t("SameAccountTip")},{label:v[m],value:m,tip:s["a"].t("AnonymousAccountTip")}],y={tableConfig:{url:"/api/v1/accounts/account-templates/",columns:["name","username","has_secret","comment","date_created","date_updated"],columnsMeta:{name:{formatterArgs:{openInNewPage:!0,getRoute:function(e){var t=e.row;e.col,e.cellValue;return{name:"AccountTemplateDetail",params:{id:t.id}}}}},has_secret:{formatterArgs:{showFalse:!1}},actions:{has:!1}}},headerActions:{hasLeftActions:!1,hasImport:!1,hasExport:!1}}},d3b7:function(e,t,a){}}]);
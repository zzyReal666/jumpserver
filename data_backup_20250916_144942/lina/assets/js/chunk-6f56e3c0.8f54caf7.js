(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6f56e3c0"],{"260f":function(e,t,n){"use strict";var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.iVisible?n("Dialog",e._g(e._b({attrs:{"close-on-click-modal":!1,"confirm-title":e.$tc("Add"),"destroy-on-close":!0,model:!1,title:e.$tc("SelectTemplate"),visible:e.iVisible,width:"800px"},on:{"update:visible":function(t){e.iVisible=t},cancel:e.handleCancel,confirm:e.handleConfirm}},"Dialog",e.$attrs,!1),e.$listeners),[[n("ListTable",{ref:"listTable",attrs:{"header-actions":e.headerActions,"table-config":e.tableConfig}})]],2):e._e(),e._v(" "),e.isShowCreate?n("CreateAccountTemplateDialog",e._g({attrs:{"create-visible":e.isShowCreate},on:{"update:createVisible":function(t){e.isShowCreate=t},"update:create-visible":function(t){e.isShowCreate=t},onPerform:e.onCreateTemplatePerform}},e.$listeners)):e._e()],1)},c=[],i=(n("20d6"),n("75fc")),o=(n("57e7"),n("d25f"),n("759f"),n("7f7f"),n("6d67"),n("6b54"),n("87b3"),n("9039")),r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.isVisible?n("Dialog",{attrs:{"show-cancel":!1,"show-confirm":!1,title:e.$tc("TemplateCreate"),visible:e.isVisible,width:"70%"},on:{"update:visible":function(t){e.isVisible=t}}},[n("GenericCreateUpdateForm",e._b({},"GenericCreateUpdateForm",e.formConfig,!1))],1):e._e()],1)},s=[],u=(n("1c01"),n("58b2"),n("8e6e"),n("6762"),n("2fdb"),n("456d"),n("ac6a"),n("f3e2"),n("bd86")),l=n("2af9"),p=n("d0aa"),d=n("5225");function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){Object(u["a"])(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var m={name:"EmailContent",components:{GenericCreateUpdateForm:p["a"],Dialog:l["i"]},props:{createVisible:{type:Boolean,default:!1},category:{type:String,default:"all"}},data:function(){var e=this;return{formConfig:{initial:{secret_type:"password"},url:"/api/v1/accounts/account-templates/",getUrl:function(){return"/api/v1/accounts/account-templates/"},needGetObjectDetail:!1,hasDetailInMsg:!1,fields:Object(i["a"])(Object(d["a"])(this)),fieldsMeta:h({},Object(d["b"])(this)),hasSaveContinue:!1,cleanFormValue:function(e){return Object.keys(e).forEach((function(t,n,a){["ssh_key","token","access_key"].includes(t)&&(e["secret"]=e[t],delete e[t])})),e},createSuccessNextRoute:{name:""},onPerformSuccess:function(t){e.isVisible=!1,e.$emit("onPerform")}}}},computed:{isVisible:{set:function(e){this.$emit("update:create-visible",e)},get:function(){return this.createVisible}}},methods:{}},b=m,v=n("2877"),g=Object(v["a"])(b,r,s,!1,null,null,null),y=g.exports,_={name:"AccountTemplateDialog",components:{Dialog:o["a"],ListTable:l["j"],CreateAccountTemplateDialog:y},props:{visible:{type:Boolean,default:!1},asset:{type:Object,default:function(){}},accounts:{type:Array,default:function(){return[]}},showCreate:{type:Boolean,default:!0}},data:function(){var e,t,n=this,a=this.$createElement,c=(null===(e=this.asset)||void 0===e||null===(t=e.protocols)||void 0===t?void 0:t.map((function(e){return e.name})).toString())||"";return{isShowCreate:!1,accountsSelected:[],tableConfig:{url:"/api/v1/accounts/account-templates/?protocols=".concat(c),columns:["name","username","secret_type","privileged"],columnsMeta:{name:{formatter:function(e){return a("span",[e.name])}},privileged:{width:"120px"},actions:{has:!1}},listeners:{"toggle-row-selection":function(e,t){e?n.addRowToSelect(t):n.removeRowToSelect(t)}},theRowDefaultIsSelected:function(e){return n.accounts.some((function(t){return t.id===e.id}))}},headerActions:{onCreate:function(){n.isShowCreate=!0},hasCreate:this.showCreate,hasMoreActions:!1,hasColumnSetting:!1,hasImport:!1,hasExport:!1}}},computed:{refTable:function(){return this.$refs.listTable.$refs.ListTable.$refs.dataTable.$refs.dataTable},iVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{onCreateTemplatePerform:function(){this.refTable.getList()},handleConfirm:function(){var e;this.iVisible=!1;var t=this.accounts.filter((function(e){return null===e||void 0===e?void 0:e.template})).map((function(e){return e.template})),n=this.accountsSelected.filter((function(e){return-1===t.indexOf(e.id)})).map((function(e){return{template:e.id,name:e.name,username:e.username,secret_type:e.secret_type.value,privileged:e.privileged}}));(e=this.accounts).push.apply(e,Object(i["a"])(n)),this.$emit("onConfirm",this.accounts)},handleCancel:function(){this.iVisible=!1},onAddClick:function(){this.isShowCreate=!0},hasSelectValue:function(e){return this.accountsSelected.some((function(t){return t.id===e.id}))},hasSameTypeAccount:function(e){var t=this.accounts.filter((function(e){return!(null!==e&&void 0!==e&&e.id)})),n=[].concat(Object(i["a"])(t),Object(i["a"])(this.accountsSelected)),a=n.some((function(t){return e.username===t.username&&(e.secret_type.value===t.secret_type||e.secret_type.value===t.secret_type.value)}));return a&&(this.refTable.toggleRowSelection(e,!1),this.$message.error(this.$tc("SameTypeAccountTip"))),a},addRowToSelect:function(e){var t=this.hasSelectValue(e),n=this.hasSameTypeAccount(e);t||n||this.accountsSelected.push(e)},removeRowToSelect:function(e){var t=this.hasSelectValue(e);if(t){var n=this.accountsSelected.findIndex((function(t){return(null===t||void 0===t?void 0:t.id)===e.id}));this.accountsSelected.splice(n,1)}}}},w=_,$=(n("64bc"),Object(v["a"])(w,a,c,!1,null,"3e72af18",null));t["a"]=$.exports},5225:function(e,t,n){"use strict";n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return p}));var a=n("75fc"),c=(n("6762"),n("768b")),i=(n("7f7f"),n("dbfd")),o=n("f823"),r=n("49bd"),s=n("863c"),u=n("0692"),l=function(e){return[[e.$t("Basic"),["name","username","privileged","su_from"]],[e.$t("Secret"),["secret_type","secret_strategy","password_rules","secret","ssh_key","token","access_key","passphrase","api_key"]],[e.$t("AutoPush"),["auto_push","platforms","push_params"]],[e.$t("Other"),["comment"]]]},p=function(e){var t=Object(i["m"])(e.$route.path),n=[],l=["password","ssh_key"],p={disabled:!1};return{su_from:{component:r["a"],el:{multiple:!1,clearable:!0,ajax:{url:"/api/v1/accounts/account-templates/su-from-account-templates/?".concat(t?"template_id="+t:""),transformOption:function(e){return{label:"".concat(e.name,"(").concat(e.username,")"),value:e.id}}}}},secret_type:{type:"radio-group",on:{change:function(e,t){var n=Object(c["a"])(e,1),a=n[0];l.includes(a)?p.disabled=!1:(t({secret_strategy:"specific"}),t({auto_push:!1}),p.disabled=!0)}}},secret_strategy:{hidden:function(e){return!l.includes(e.secret_type)}},secret:{label:e.$t("Password"),component:o["m"],hidden:function(e){return"password"!==e.secret_type||"random"===e.secret_strategy}},ssh_key:{label:e.$t("PrivateKey"),el:{type:"textarea",rows:4},component:o["n"],hidden:function(e){return"ssh_key"!==e.secret_type||"random"===e.secret_strategy}},passphrase:{label:e.$t("Passphrase"),component:o["m"],hidden:function(e){return"ssh_key"!==e.secret_type||"random"===e.secret_strategy}},token:{label:e.$t("Token"),el:{type:"textarea",rows:4},hidden:function(e){return"token"!==e.secret_type||"random"===e.secret_strategy}},access_key:{label:e.$t("AccessKey"),el:{type:"textarea",rows:4},hidden:function(e){return"access_key"!==e.secret_type||"random"===e.secret_strategy}},api_key:{label:e.$t("ApiKey"),el:{type:"textarea",rows:4},hidden:function(e){return"api_key"!==e.secret_type||"random"===e.secret_strategy}},password_rules:{component:o["g"],label:u["a"].t("PasswordRule"),hidden:function(e){var t=e.secret_strategy,n=e.secret_type;return"specific"===t||"password"!==n}},platforms:{el:{multiple:!0,ajax:{url:"/api/v1/assets/platforms/",transformOption:function(e){return{label:e.name,value:e.id}}}},on:{input:function(e,t){var i=Object(c["a"])(e,1),o=i[0];n.splice(0,n.length),n.push.apply(n,Object(a["a"])(o))}},hidden:function(e){return!e["auto_push"]}},auto_push:{el:p},push_params:{component:s["a"],el:{platforms:n,method:"push_account_method"},hidden:function(e){return!e["auto_push"]}}}}},"64bc":function(e,t,n){"use strict";n("a9d3")},"707f":function(e,t,n){"use strict";n.r(t);var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("GenericDetailPage",e._g(e._b({attrs:{"active-menu":e.config.activeMenu,object:e.account},on:{"update:activeMenu":function(t){return e.$set(e.config,"activeMenu",t)},"update:active-menu":function(t){return e.$set(e.config,"activeMenu",t)},"update:object":function(t){e.account=t}}},"GenericDetailPage",e.config,!1),e.$listeners),[n("keep-alive",[n(e.config.activeMenu,{tag:"component",attrs:{object:e.account}})],1)],1),e._v(" "),e.AccountVisible?n("AccountCreateUpdate",{attrs:{account:e.account,asset:e.account.asset,title:e.$tc("UpdateAccount"),visible:e.AccountVisible},on:{"update:visible":function(t){e.AccountVisible=t},add:e.addAccountSuccess}}):e._e()],1)},c=[],i=(n("7f7f"),function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("TwoCol",{scopedSlots:e._u([{key:"right",fn:function(){return[n("QuickActions",{attrs:{actions:e.quickActions,type:"primary"}}),e._v(" "),e.showViewSecretDialog?n("ViewSecret",{attrs:{account:e.object,url:e.secretUrl,visible:e.showViewSecretDialog},on:{"update:visible":function(t){e.showViewSecretDialog=t}}}):e._e(),e._v(" "),n("AutomationParamsForm",{attrs:{"has-button":!1,method:e.pushAccountMethod,visible:e.autoPushVisible},on:{"update:visible":function(t){e.autoPushVisible=t},canSetting:e.onCanSetting,submit:e.onSubmit}})]},proxy:!0}])},[[n("AutoDetailCard",e._b({attrs:{object:e.object}},"AutoDetailCard",e.detail,!1))]],2),e._v(" "),n("el-drawer",{attrs:{"append-to-body":!0,visible:e.pamDrawerShow,"with-header":!1,size:"50%"},on:{"update:visible":function(t){e.pamDrawerShow=t}}},[n(e.drawerRefName,{tag:"component"})],1)],1)}),o=[],r=(n("0d6d"),n("e3bc")),s=n("fcd5"),u=n("8e48"),l=n("ac6b"),p=n("e323"),d=n("2dc2"),f=n("52cc"),h={name:"Detail",components:{TwoCol:f["a"],AutoDetailCard:r["a"],QuickActions:s["a"],AssetDetail:d["default"],AutomationParamsForm:p["a"],ViewSecret:u["a"]},props:{object:{type:Object,default:function(){}}},data:function(){var e,t,n,a,c,i,o,r,s=this,u=this.$createElement,p=this;return{pamDrawerShow:!1,drawerRefName:null,needSetAutoPushParams:!1,autoPushVisible:!1,secretUrl:"/api/v1/accounts/account-secrets/".concat(this.object.id,"/"),showViewSecretDialog:!1,quickActions:[{title:this.$t("Active"),type:"switcher",attrs:{model:p.object.is_active,disabled:!p.$hasPerm("accounts.change_account")},callbacks:Object.freeze({change:function(e){s.$axios.patch("/api/v1/accounts/accounts/".concat(s.object.id,"/"),{is_active:e,name:s.object.name}).then((function(e){s.$message.success(s.$tc("UpdateSuccessMsg"))}))}})},{title:this.$t("Privileged"),type:"switcher",attrs:{model:p.object.privileged,disabled:!p.$hasPerm("accounts.change_account")},callbacks:Object.freeze({change:function(e){var t;s.$axios.patch("/api/v1/accounts/accounts/".concat(s.object.id,"/"),{name:null===(t=s.object)||void 0===t?void 0:t.name,privileged:e}).then((function(e){s.$message.success(s.$tc("UpdateSuccessMsg"))}))}})},{title:this.$t("TestAccountConnective"),attrs:{type:"primary",label:this.$t("Test"),disabled:!p.$hasPerm("accounts.verify_account")||!(null!==(e=p.object.asset.auto_config)&&void 0!==e&&e.ansible_enabled)||!(null!==(t=p.object.asset.auto_config)&&void 0!==t&&t.ping_enabled)||this.$store.getters.currentOrgIsRoot},callbacks:Object.freeze({click:function(){s.$axios.post("/api/v1/accounts/accounts/tasks/",{action:"verify",accounts:[s.object.id]}).then((function(e){Object(l["k"])(e["task"])}))}})},{title:this.$t("PushAccount"),attrs:{type:"primary",label:this.$t("Push"),disabled:!p.$hasPerm("accounts.push_account")||!(null!==(n=p.object.asset.auto_config)&&void 0!==n&&n.push_account_enabled)||this.$store.getters.currentOrgIsRoot},callbacks:Object.freeze({click:function(){s.needSetAutoPushParams?s.autoPushVisible=!0:s.$axios.post("/api/v1/accounts/accounts/tasks/",{action:"push",accounts:[s.object.id]}).then((function(e){Object(l["k"])(e["task"])}))}})},{title:this.$t("ViewSecret"),attrs:{type:"primary",label:this.$t("View"),disabled:!p.$hasPerm("accounts.view_accountsecret")},callbacks:Object.freeze({click:function(){p.showViewSecretDialog=!1,setTimeout((function(){p.showViewSecretDialog=!0}))}})},{title:this.$t("ClearSecret"),attrs:{type:"primary",label:this.$t("Clear"),disabled:!p.$hasPerm("accounts.change_account")},callbacks:Object.freeze({click:function(){s.$axios.patch("/api/v1/accounts/accounts/clear-secret/",{account_ids:[s.object.id]}).then((function(){s.$message.success(s.$tc("ClearSuccessMsg"))}))}})},{title:this.$t("SuFrom"),type:"updateSelect",attrs:{type:"primary",class:"su-from-select2",multiple:!1,clearable:!0,model:(null===(a=p.object.su_from)||void 0===a?void 0:a.id)||"",label:null!==(c=p.object.su_from)&&void 0!==c&&c.name?(null===(i=p.object.su_from)||void 0===i?void 0:i.name)+"(".concat(null===(o=p.object.su_from)||void 0===o?void 0:o.username,")"):"-",ajax:{url:"/api/v1/accounts/accounts/su-from-accounts/?account=".concat(p.object.id,"&fields_size=mini"),transformOption:function(e){return{label:e.name+"("+e.username+")",value:e.id}}},disabled:!p.$hasPerm("accounts.change_account")||!(null!==(r=p.object.asset.auto_config)&&void 0!==r&&r.su_enabled)},callbacks:Object.freeze({change:function(e){var t="/api/v1/accounts/accounts/".concat(s.object.id,"/");return s.$axios.patch(t,{su_from:e,name:s.object.name})}})}],detail:{url:"/api/v1/accounts/accounts/".concat(this.object.id),excludes:["template","privileged","secret","passphrase","spec_info","params"],formatters:{asset:function(e,t){return u("span",[null===t||void 0===t?void 0:t.name])},su_from:function(e,t){return u("span",[null!==t&&void 0!==t&&t.name?(null===t||void 0===t?void 0:t.name)+"(".concat(null===t||void 0===t?void 0:t.username,")"):""])}}}}},computed:{pushAccountMethod:function(){var e,t;return(null===(e=this.object.asset)||void 0===e||null===(t=e.auto_config)||void 0===t?void 0:t.push_account_method)||""}},methods:{onCanSetting:function(e){this.needSetAutoPushParams=e},onSubmit:function(e){this.$axios.post("/api/v1/accounts/accounts/tasks/",{action:"push",accounts:[this.object.id],params:e}).then((function(e){Object(l["k"])(e["task"])}))}}},m=h,b=n("2877"),v=Object(b["a"])(m,i,o,!1,null,"7ee63406",null),g=v.exports,y=n("cd4a"),_=n("5838"),w={components:{TabPage:y["l"],Detail:g,GenericDetailPage:y["d"],AccountCreateUpdate:_["a"]},data:function(){var e=this;return{AccountVisible:!1,account:{},config:{url:"/api/v1/accounts/accounts",activeMenu:"Detail",submenu:[{title:this.$t("Basic"),name:"Detail"}],actions:{hasUpdate:function(){return!0},updateCallback:function(){var t=e;t.AccountVisible=!1,setTimeout((function(){t.AccountVisible=!0}))}}}}},methods:{addAccountSuccess:function(){this.$store.commit("common/reload")},getPageTitle:function(e){var t=e.row;return"".concat(t.username,"@").concat(t.asset.name)}}},$=w,j=Object(b["a"])($,a,c,!1,null,null,null);t["default"]=j.exports},a9d3:function(e,t,n){},bd11:function(e,t){e.exports=v,e.exports.match=r,e.exports.regexpToFunction=s,e.exports.parse=c,e.exports.compile=o,e.exports.tokensToFunction=u,e.exports.tokensToRegExp=b;var n="/",a=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function c(e,t){var c,o=[],r=0,s=0,u="",l=t&&t.delimiter||n,d=t&&t.whitelist||void 0,f=!1;while(null!==(c=a.exec(e))){var h=c[0],m=c[1],b=c.index;if(u+=e.slice(s,b),s=b+h.length,m)u+=m[1],f=!0;else{var v="",g=c[2],y=c[3],_=c[4],w=c[5];if(!f&&u.length){var $=u.length-1,j=u[$],S=!d||d.indexOf(j)>-1;S&&(v=j,u=u.slice(0,$))}u&&(o.push(u),u="",f=!1);var x="+"===w||"*"===w,O="?"===w||"*"===w,k=y||_,A=v||l,C=v||("string"===typeof o[o.length-1]?o[o.length-1]:"");o.push({name:g||r++,prefix:v,delimiter:A,optional:O,repeat:x,pattern:k?p(k):i(A,l,C)})}}return(u||s<e.length)&&o.push(u+e.substr(s)),o}function i(e,t,n){var a="[^"+l(e===t?e:e+t)+"]";return!n||n.indexOf(e)>-1||n.indexOf(t)>-1?a+"+?":l(n)+"|(?:(?!"+l(n)+")"+a+")+?"}function o(e,t){return u(c(e,t),t)}function r(e,t){var n=[],a=v(e,n,t);return s(a,n)}function s(e,t){return function(n,a){var c=e.exec(n);if(!c)return!1;for(var i=c[0],o=c.index,r={},s=a&&a.decode||decodeURIComponent,u=1;u<c.length;u++)if(void 0!==c[u]){var l=t[u-1];l.repeat?r[l.name]=c[u].split(l.delimiter).map((function(e){return s(e,l)})):r[l.name]=s(c[u],l)}return{path:i,index:o,params:r}}}function u(e,t){for(var n=new Array(e.length),a=0;a<e.length;a++)"object"===typeof e[a]&&(n[a]=new RegExp("^(?:"+e[a].pattern+")$",d(t)));return function(t,a){for(var c="",i=a&&a.encode||encodeURIComponent,o=!a||!1!==a.validate,r=0;r<e.length;r++){var s=e[r];if("string"!==typeof s){var u,l=t?t[s.name]:void 0;if(Array.isArray(l)){if(!s.repeat)throw new TypeError('Expected "'+s.name+'" to not repeat, but got array');if(0===l.length){if(s.optional)continue;throw new TypeError('Expected "'+s.name+'" to not be empty')}for(var p=0;p<l.length;p++){if(u=i(l[p],s),o&&!n[r].test(u))throw new TypeError('Expected all "'+s.name+'" to match "'+s.pattern+'"');c+=(0===p?s.prefix:s.delimiter)+u}}else if("string"!==typeof l&&"number"!==typeof l&&"boolean"!==typeof l){if(!s.optional)throw new TypeError('Expected "'+s.name+'" to be '+(s.repeat?"an array":"a string"))}else{if(u=i(String(l),s),o&&!n[r].test(u))throw new TypeError('Expected "'+s.name+'" to match "'+s.pattern+'", but got "'+u+'"');c+=s.prefix+u}}else c+=s}return c}}function l(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function p(e){return e.replace(/([=!:$/()])/g,"\\$1")}function d(e){return e&&e.sensitive?"":"i"}function f(e,t){if(!t)return e;var n=e.source.match(/\((?!\?)/g);if(n)for(var a=0;a<n.length;a++)t.push({name:a,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}function h(e,t,n){for(var a=[],c=0;c<e.length;c++)a.push(v(e[c],t,n).source);return new RegExp("(?:"+a.join("|")+")",d(n))}function m(e,t,n){return b(c(e,n),t,n)}function b(e,t,a){a=a||{};for(var c=a.strict,i=!1!==a.start,o=!1!==a.end,r=a.delimiter||n,s=[].concat(a.endsWith||[]).map(l).concat("$").join("|"),u=i?"^":"",p=0;p<e.length;p++){var f=e[p];if("string"===typeof f)u+=l(f);else{var h=f.repeat?"(?:"+f.pattern+")(?:"+l(f.delimiter)+"(?:"+f.pattern+"))*":f.pattern;t&&t.push(f),f.optional?f.prefix?u+="(?:"+l(f.prefix)+"("+h+"))?":u+="("+h+")?":u+=l(f.prefix)+"("+h+")"}}if(o)c||(u+="(?:"+l(r)+")?"),u+="$"===s?"$":"(?="+s+")";else{var m=e[e.length-1],b="string"===typeof m?m[m.length-1]===r:void 0===m;c||(u+="(?:"+l(r)+"(?="+s+"))?"),b||(u+="(?="+l(r)+"|"+s+")")}return new RegExp(u,d(a))}function v(e,t,n){return e instanceof RegExp?f(e,t):Array.isArray(e)?h(e,t,n):m(e,t,n)}}}]);
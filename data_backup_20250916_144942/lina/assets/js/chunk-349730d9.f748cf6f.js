(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-349730d9"],{"2e4e":function(e,t,i){},3232:function(e,t,i){"use strict";i("9ae4")},6635:function(e,t,i){"use strict";i("2e4e")},"9ae4":function(e,t,i){},b3af:function(e,t,i){"use strict";var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[i("div",{staticClass:"variables el-data-table"},[i("el-table",{staticClass:"el-table--fit el-table--border",attrs:{data:e.variables}},[i("el-table-column",{attrs:{"show-overflow-tooltip":"",label:e.$tc("Name"),prop:"name"}}),e._v(" "),i("el-table-column",{attrs:{"show-overflow-tooltip":"",label:e.$tc("VariableName"),prop:"var_name"}}),e._v(" "),i("el-table-column",{attrs:{"show-overflow-tooltip":"",label:e.$tc("DefaultValue"),prop:"default_value"}}),e._v(" "),e.disableEdit?e._e():i("el-table-column",{attrs:{label:e.$tc("Actions"),align:"center","class-name":"buttons",fixed:"right",width:"135"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{icon:"el-icon-minus",size:"mini",type:"danger"},on:{click:function(i){return e.removeVariable(t.row)}}}),e._v(" "),i("el-button",{attrs:{disabled:!!t.row.template,icon:"el-icon-edit",size:"mini",type:"primary"},on:{click:function(i){return e.onEditClick(t.row)}}})]}}],null,!1,3037588530)})],1),e._v(" "),e.disableEdit?e._e():i("div",{staticClass:"actions"},[i("el-button",{attrs:{size:"mini",type:"primary"},on:{click:e.onAddClick}},[e._v("\n        "+e._s(e.$t("Add"))+"\n      ")])],1),e._v(" "),i("AddVariableDialog",{attrs:{variable:e.variable,variables:e.variables,visible:e.addVariableDialogVisible},on:{"update:visible":function(t){e.addVariableDialogVisible=t}}})],1)])},n=[],o=(i("7f7f"),i("d25f"),i("6d67"),function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.iVisible?i("Dialog",{attrs:{"destroy-on-close":!0,"show-cancel":!1,"show-confirm":!1,title:e.$tc("AddVariable"),visible:e.iVisible,width:"800px"},on:{"update:visible":function(t){e.iVisible=t}}},[i("VariableCreateForm",{attrs:{variable:e.variable},on:{add:e.addVariable,edit:e.editVariable}})],1):e._e()}),r=[],l=(i("20d6"),i("9039")),s=i("1efb"),c={name:"AddVariableDialog",components:{Dialog:l["a"],VariableCreateForm:s["a"]},props:{visible:{type:Boolean,default:!1},variable:{type:Object,default:function(){return{}}},variables:{type:Array,default:function(){return[]}}},computed:{iVisible:{get:function(){return this.visible},set:function(e){this.$emit("update:visible",e)}}},methods:{addVariable:function(e){var t=this.variables.findIndex((function(t){return t.name===e.name||t.var_name===e.var_name}));-1!==t&&this.variables.splice(t,1),this.variables.push(e),this.iVisible=!1},editVariable:function(e){var t=this,i=this.variables.findIndex((function(e){return e.var_name===t.variable.var_name}));this.variables.splice(i,1,e);var a=this.variables.filter((function(t){return t.var_name===e.var_name||t.name===e.name})).length;a>1&&this.variables.splice(i,1),this.iVisible=!1}}},u=c,d=i("2877"),b=Object(d["a"])(u,o,r,!1,null,"e0757cc0",null),f=b.exports,h={name:"Variable",components:{AddVariableDialog:f},props:{value:{type:[Array],default:function(){return[]}},disableEdit:{type:Boolean,default:!1}},data:function(){return{variable:{},initial:!1,addVariableDialogVisible:!1}},computed:{variables:{get:function(){return this.value},set:function(e){this.$emit("update:value",e),this.$emit("change",e)}}},watch:{variables:{handler:function(e,t){void 0!==t&&((e.length>0||!this.initial)&&(e.map((function(e){e.default_value=e.text_default_value||e.select_default_value||void 0})),this.$emit("input",e)),e&&(this.initial=!0))},immediate:!0,deep:!0}},methods:{removeVariable:function(e){this.variables=this.variables.filter((function(t){return e.id&&t.id?t.id!==e.id:e.var_name&&t.var_name?t.var_name!==e.var_name:e.name!==t.name}))},onEditClick:function(e){var t=this;this.variable=e,setTimeout((function(){t.addVariableDialogVisible=!0}))},onAddClick:function(){var e=this;this.variable=null,setTimeout((function(){e.addVariableDialogVisible=!0}))}}},v=h,p=(i("3232"),Object(d["a"])(v,a,n,!1,null,"494ead85",null));t["a"]=p.exports},e868:function(e,t,i){"use strict";i.r(t);var a=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("GenericDetailPage",e._g(e._b({attrs:{"active-menu":e.config.activeMenu,object:e.PlaybookDetail},on:{"update:activeMenu":function(t){return e.$set(e.config,"activeMenu",t)},"update:active-menu":function(t){return e.$set(e.config,"activeMenu",t)},"update:object":function(t){e.PlaybookDetail=t}}},"GenericDetailPage",e.config,!1),e.$listeners),[i("keep-alive",[i(e.config.activeMenu,{tag:"component",attrs:{object:e.PlaybookDetail}})],1)],1)},n=[],o=(i("7f7f"),i("cd4a")),r=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("TwoCol",[i("AutoDetailCard",{attrs:{excludes:e.excludes,object:e.object,url:e.url}})],1)},l=[],s=i("e3bc"),c=i("52cc"),u={components:{TwoCol:c["a"],AutoDetailCard:s["a"]},props:{object:{type:Object,default:function(){return{}}}},data:function(){return{url:"/api/v1/ops/playbooks/".concat(this.object.id,"/"),excludes:["variable","path","create_method","vcs_url"]}},computed:{cardTitle:function(){return this.object.name}},methods:{}},d=u,b=i("2877"),f=Object(b["a"])(d,r,l,!1,null,"be3ee6e4",null),h=f.exports,v=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",[e.createDialogVisible?i("NewNodeDialog",{attrs:{visible:e.createDialogVisible},on:{"update:visible":function(t){e.createDialogVisible=t},confirm:e.doCreate}}):e._e(),e._v(" "),i("TreeTable",{ref:"TreeTable",attrs:{"tree-setting":e.treeSetting}},[e.disableEdit?e._e():i("template",{slot:"rMenu"},[i("li",{staticClass:"rmenu",attrs:{id:"m_create_file",tabindex:"-1"},on:{click:function(t){return e.onCreate("file")}}},[e._v("\n        "+e._s(e.$tc("NewFile"))+"\n      ")]),e._v(" "),i("li",{staticClass:"rmenu",attrs:{id:"m_create_directory",tabindex:"-1"},on:{click:function(t){return e.onCreate("directory")}}},[e._v("\n        "+e._s(e.$tc("NewDirectory"))+"\n      ")]),e._v(" "),i("li",{staticClass:"rmenu",attrs:{id:"m_rename",tabindex:"-1"},on:{click:e.onRename}},[e._v("\n        "+e._s(e.$tc("Rename"))+"\n      ")]),e._v(" "),i("li",{staticClass:"rmenu",attrs:{id:"m_delete",tabindex:"-1"},on:{click:e.onDelete}},[e._v("\n        "+e._s(e.$tc("Delete"))+"\n      ")])]),e._v(" "),i("template",{slot:"table"},[i("div",{staticClass:"transition-box",staticStyle:{width:"calc(100% - 17px)"}},[i("el-tabs",{staticClass:"workspace-tab",attrs:{closable:!0},on:{"tab-remove":e.onCloseEditor},model:{value:e.activeEditorId,callback:function(t){e.activeEditorId=t},expression:"activeEditorId"}},e._l(e.openedEditor,(function(t,a){return i("el-tab-pane",{key:a,attrs:{label:e.tabLabel(t),name:a}},[i("CodeEditor",{staticStyle:{"margin-bottom":"20px"},attrs:{options:e.cmOptions,toolbar:e.toolbar,value:t.value},on:{"update:value":function(i){return e.$set(t,"value",i)}}})],1)})),1),e._v(" "),i("div",{staticStyle:{display:"flex","margin-top":"10px","justify-content":"space-between"}}),e._v(" "),i("el-form",{ref:"form",attrs:{"label-position":"left","label-width":"30px"}},[i("div",{staticClass:"form-content"},[i("el-form-item",{attrs:{label:"",prop:"variable"}},[i("Variable",{attrs:{value:e.variables,"disable-edit":e.disableEdit},on:{"update:value":function(t){e.variables=t},"update:disableEdit":function(t){e.disableEdit=t},"update:disable-edit":function(t){e.disableEdit=t},input:e.setVariable}})],1)],1)])],1)])],2)],1)},p=[],m=(i("a481"),i("ac6a"),i("456d"),i("d92a"),i("2af9")),g=i("32b3"),y=i("3196"),_=function(){var e=this,t=e.$createElement,i=e._self._c||t;return e.iVisible?i("Dialog",{attrs:{"show-cancel":!1,"show-confirm":!0,title:e.$tc("NewFile"),visible:e.iVisible,top:"1vh",width:"40%"},on:{"update:visible":function(t){e.iVisible=t},confirm:e.onConfirm}},[i("el-form",[i("el-form-item",{attrs:{label:e.$tc("DisplayName")}},[i("el-input",{model:{value:e.name,callback:function(t){e.name=t},expression:"name"}})],1)],1)],1):e._e()},$=[],k=i("9039"),V={components:{Dialog:k["a"]},props:{visible:{type:Boolean,default:!1}},data:function(){return{name:""}},computed:{iVisible:{set:function(e){this.$emit("update:visible",e)},get:function(){return this.visible}}},mounted:function(){},methods:{onConfirm:function(){this.$emit("confirm",this.name),this.iVisible=!1}}},E=V,C=Object(b["a"])(E,_,$,!1,null,null,null),w=C.exports,D=i("1e05"),T=i("b3af"),x={name:"CommandExecution",components:{NewNodeDialog:w,TreeTable:m["r"],CodeEditor:g["a"],Variable:T["a"]},props:{object:{type:Object,default:function(){}}},data:function(){var e=this,t=this.object.creator!==this.$store.state.users.profile.id;return{disableEdit:t,newNode:{},createDialogVisible:!1,createType:"directory",parentId:"",closing:!1,DataZTree:0,cmOptions:{mode:"yaml",readOnly:t},toolbar:{left:{save:{type:"button",align:"left",icon:"fa fa-save",tip:this.$tc("Save"),el:{type:"primary"},isVisible:t,callback:function(){e.onSave()}},reset:{type:"button",align:"left",icon:"fa fa-undo",tip:this.$tc("Reset"),el:{type:"primary"},isVisible:t,callback:function(){e.onReset()}}}},treeSetting:{async:!1,treeUrl:"/api/v1/ops/playbook/".concat(this.object.id,"/file/"),showRefresh:!0,showMenu:!0,showDelete:!1,showCreate:!1,showUpdate:!1,showSearch:!1,callback:{onSelected:function(e,t){t.isParent||this.onOpenEditor(t)}.bind(this),refresh:function(e,t){},onRename:function(e,t,i,a){var n=this;a||Object(D["e"])(this.object.id,{key:i.id,new_name:i.name,is_directory:i.isParent}).then().finally((function(){n.refreshTree()}))}.bind(this)},check:{enable:!1},view:{dblClickExpand:!1,showLine:!0}},iShowTree:!0,activeEditorId:"",openedEditor:{},variables:[]}},computed:{item:function(){return y["a"]},zTree:function(){return this.$refs.TreeTable.$refs.AutoDataZTree.$refs.dataztree.zTree},dataztree:function(){return this.$refs.TreeTable.$refs.AutoDataZTree},activeEditor:function(){return this.openedEditor[this.activeEditorId]},refreshTree:function(){return this.$refs.TreeTable.$refs.AutoDataZTree.$refs.dataztree.refresh}},mounted:function(){var e;this.variables=null===(e=this.object)||void 0===e?void 0:e.variable,this.onOpenEditor({id:"main.yml",name:"main.yml"})},methods:{refreshEditor:function(e,t){this.openedEditor[e].name=t},onReset:function(){var e=this.activeEditor;e.value=e.originValue},onSave:function(){var e=this,t=this.activeEditor;this.$axios.patch("/api/v1/ops/playbook/".concat(this.object.id,"/file/"),{key:this.activeEditorId,content:t.value}).then((function(i){t.originValue=t.value,e.closing&&e.remoteTab(t.key),e.$message.success(e.$tc("SaveSuccess"))}))},onCreate:function(e){this.dataztree.hideRMenu(),this.createDialogVisible=!0,this.createType=e},doCreate:function(e){var t=this,i=this.zTree.getSelectedNodes()[0];if(i){var a=i.isParent?i.id:i.pId,n={key:a,is_directory:"directory"===this.createType,name:e};this.$axios.post("/api/v1/ops/playbook/".concat(this.object.id,"/file/"),n).then((function(e){t.refreshTree()}))}},onDelete:function(){var e=this;this.dataztree.hideRMenu();var t=this.zTree.getSelectedNodes()[0];t&&this.$confirm(this.$tc("DeleteConfirmMessage"),this.$tc("Delete"),{confirmButtonText:this.$tc("Confirm"),cancelButtonText:this.$tc("Cancel"),type:"warning"}).then((function(){e.$axios.delete("/api/v1/ops/playbook/".concat(e.object.id,"/file/?key=").concat(t.id)).then((function(){t.isParent||e.remoteTab(t.id),e.refreshTree(),e.$message({type:"success",message:e.$tc("DeleteSuccess")})}))}))},onRename:function(){this.dataztree.hideRMenu();var e=this.zTree.getSelectedNodes()[0];e&&this.zTree.editName(e)},onOpenEditor:function(e){this.$set(this.openedEditor,e.id,{key:e.id,name:e.name,originValue:"",value:""}),this.activeEditorId=e.id,this.getFileContent(e.id)},onCloseEditor:function(e){var t=this,i=this.openedEditor[e],a="";this.hasChange(i)?(a=this.$tc("CloseConfirmMessage"),this.$confirm(a,this.$tc("CloseConfirm"),{confirmButtonText:this.$tc("Confirm"),cancelButtonText:this.$tc("Cancel"),type:"warning"}).then((function(){t.closing=!0,t.onSave()})).catch((function(){t.remoteTab(e)}))):this.remoteTab(e)},remoteTab:function(e){this.$delete(this.openedEditor,e);var t=Object.keys(this.openedEditor);0!==t.length&&(this.activeEditorId=t[t.length-1])},getFileContent:function(e){var t=this;this.$axios.get("/api/v1/ops/playbook/".concat(this.object.id,"/file/?key=").concat(e)).then((function(i){t.openedEditor[e].value=i.content,t.openedEditor[e].originValue=i.content}))},tabLabel:function(e){return this.hasChange(e)?(e.key+" M").replace("root/",""):e.key.replace("root/","")},hasChange:function(e){return e.value!==e.originValue},setVariable:function(e){var t=this;this.disableEdit||this.$axios.patch("/api/v1/ops/playbooks/".concat(this.object.id,"/"),{variable:e}).catch((function(e){t.$message.error(t.$tc("UpdateErrorMsg")+" "+e)}))}}},j=x,S=(i("6635"),Object(b["a"])(j,v,p,!1,null,"5cf57641",null)),O=S.exports,z={components:{GenericDetailPage:o["d"],PlaybookDetail:h,Workspace:O},data:function(){return{PlaybookDetail:{},config:{getTitle:function(e){return e["name"]},url:"/api/v1/ops/playbooks",activeMenu:"PlaybookDetail",submenu:[{title:this.$t("Basic"),name:"PlaybookDetail"},{title:this.$t("Workspace"),name:"Workspace"}],hasRightSide:!1}}}},A=z,M=Object(b["a"])(A,a,n,!1,null,"7a24467d",null);t["default"]=M.exports}}]);
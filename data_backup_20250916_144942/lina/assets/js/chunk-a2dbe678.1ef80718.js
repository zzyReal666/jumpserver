(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-a2dbe678","chunk-52829884"],{"0482":function(e,t,a){},"273b":function(e,t,a){"use strict";a("0482")},"3cc2":function(e,t,a){},"5e3e":function(e,t,a){},7:function(e,t){},b708:function(e,t,a){},bd11:function(e,t){e.exports=g,e.exports.match=c,e.exports.regexpToFunction=r,e.exports.parse=i,e.exports.compile=o,e.exports.tokensToFunction=u,e.exports.tokensToRegExp=m;var a="/",n=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function i(e,t){var i,o=[],c=0,r=0,u="",l=t&&t.delimiter||a,d=t&&t.whitelist||void 0,h=!1;while(null!==(i=n.exec(e))){var f=i[0],v=i[1],m=i.index;if(u+=e.slice(r,m),r=m+f.length,v)u+=v[1],h=!0;else{var g="",_=i[2],b=i[3],w=i[4],y=i[5];if(!h&&u.length){var x=u.length-1,k=u[x],j=!d||d.indexOf(k)>-1;j&&(g=k,u=u.slice(0,x))}u&&(o.push(u),u="",h=!1);var $="+"===y||"*"===y,O="?"===y||"*"===y,P=b||w,S=g||l,D=g||("string"===typeof o[o.length-1]?o[o.length-1]:"");o.push({name:_||c++,prefix:g,delimiter:S,optional:O,repeat:$,pattern:P?p(P):s(S,l,D)})}}return(u||r<e.length)&&o.push(u+e.substr(r)),o}function s(e,t,a){var n="[^"+l(e===t?e:e+t)+"]";return!a||a.indexOf(e)>-1||a.indexOf(t)>-1?n+"+?":l(a)+"|(?:(?!"+l(a)+")"+n+")+?"}function o(e,t){return u(i(e,t),t)}function c(e,t){var a=[],n=g(e,a,t);return r(n,a)}function r(e,t){return function(a,n){var i=e.exec(a);if(!i)return!1;for(var s=i[0],o=i.index,c={},r=n&&n.decode||decodeURIComponent,u=1;u<i.length;u++)if(void 0!==i[u]){var l=t[u-1];l.repeat?c[l.name]=i[u].split(l.delimiter).map((function(e){return r(e,l)})):c[l.name]=r(i[u],l)}return{path:s,index:o,params:c}}}function u(e,t){for(var a=new Array(e.length),n=0;n<e.length;n++)"object"===typeof e[n]&&(a[n]=new RegExp("^(?:"+e[n].pattern+")$",d(t)));return function(t,n){for(var i="",s=n&&n.encode||encodeURIComponent,o=!n||!1!==n.validate,c=0;c<e.length;c++){var r=e[c];if("string"!==typeof r){var u,l=t?t[r.name]:void 0;if(Array.isArray(l)){if(!r.repeat)throw new TypeError('Expected "'+r.name+'" to not repeat, but got array');if(0===l.length){if(r.optional)continue;throw new TypeError('Expected "'+r.name+'" to not be empty')}for(var p=0;p<l.length;p++){if(u=s(l[p],r),o&&!a[c].test(u))throw new TypeError('Expected all "'+r.name+'" to match "'+r.pattern+'"');i+=(0===p?r.prefix:r.delimiter)+u}}else if("string"!==typeof l&&"number"!==typeof l&&"boolean"!==typeof l){if(!r.optional)throw new TypeError('Expected "'+r.name+'" to be '+(r.repeat?"an array":"a string"))}else{if(u=s(String(l),r),o&&!a[c].test(u))throw new TypeError('Expected "'+r.name+'" to match "'+r.pattern+'", but got "'+u+'"');i+=r.prefix+u}}else i+=r}return i}}function l(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function p(e){return e.replace(/([=!:$/()])/g,"\\$1")}function d(e){return e&&e.sensitive?"":"i"}function h(e,t){if(!t)return e;var a=e.source.match(/\((?!\?)/g);if(a)for(var n=0;n<a.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,pattern:null});return e}function f(e,t,a){for(var n=[],i=0;i<e.length;i++)n.push(g(e[i],t,a).source);return new RegExp("(?:"+n.join("|")+")",d(a))}function v(e,t,a){return m(i(e,a),t,a)}function m(e,t,n){n=n||{};for(var i=n.strict,s=!1!==n.start,o=!1!==n.end,c=n.delimiter||a,r=[].concat(n.endsWith||[]).map(l).concat("$").join("|"),u=s?"^":"",p=0;p<e.length;p++){var h=e[p];if("string"===typeof h)u+=l(h);else{var f=h.repeat?"(?:"+h.pattern+")(?:"+l(h.delimiter)+"(?:"+h.pattern+"))*":h.pattern;t&&t.push(h),h.optional?h.prefix?u+="(?:"+l(h.prefix)+"("+f+"))?":u+="("+f+")?":u+=l(h.prefix)+"("+f+")"}}if(o)i||(u+="(?:"+l(c)+")?"),u+="$"===r?"$":"(?="+r+")";else{var v=e[e.length-1],m="string"===typeof v?v[v.length-1]===c:void 0===v;i||(u+="(?:"+l(c)+"(?="+r+"))?"),m||(u+="(?="+l(c)+"|"+r+")")}return new RegExp(u,d(n))}function g(e,t,a){return e instanceof RegExp?h(e,t):Array.isArray(e)?f(e,t,a):v(e,t,a)}},c0eb:function(e,t,a){"use strict";var n=a("c5ec"),i=a.n(n);window.$=i.a,window.jQuery=i.a,t["a"]=i.a},d08e:function(e,t,a){"use strict";a("5e3e")},e323:function(e,t,a){"use strict";var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"content"},[e.hasButton?a("el-button",{staticClass:"proto-setting",attrs:{disabled:!e.canSetting,icon:e.icon,size:"small",type:"primary"},on:{click:e.onSetting}}):e._e(),e._v(" "),a("Dialog",{attrs:{"show-cancel":!1,"show-confirm":!1,title:e.title,visible:e.isVisible,width:"60%"},on:{"update:visible":function(t){e.isVisible=t},close:e.onDialogClose}},[a("AutoDataForm",e._g(e._b({ref:"autoDataForm",staticClass:"data-form",attrs:{form:e.form},on:{submit:e.onSubmit}},"AutoDataForm",e.config,!1),e.$listeners))],1)],1)},i=[],s=(a("1c01"),a("58b2"),a("8e6e"),a("f3e2"),a("d25f"),a("bd86")),o=a("768b"),c=(a("ffc1"),a("6762"),a("2fdb"),a("ac6a"),a("456d"),a("96cf"),a("3b8d")),r=a("9039"),u=a("c75f"),l=a("f823");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(s["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var h={components:{Dialog:r["a"],AutoDataForm:u["a"]},props:{value:{type:[String,Object],default:function(){return{}}},title:{type:String,default:function(){return this.$t("PushParams")}},btnText:{type:String,default:function(){return""}},icon:{type:String,default:"el-icon-setting"},url:{type:String,default:"/api/v1/assets/platform-automation-methods/"},method:{type:String,default:""},pushAccountParams:{type:Object,default:function(){return{}}},visible:{type:Boolean,default:!1},hasButton:{type:Boolean,default:!0}},data:function(){return{isVisible:this.visible,canSetting:!0,form:this.value,remoteMeta:{},config:{url:this.url,hasSaveContinue:!1,hasButtons:!0,hasReset:!1,fields:[],method:"get"},preFieldsMeta:{change_secret_by_ssh:{commands:{helpTextAsTip:!1}}}}},watch:{visible:function(e){this.isVisible=e},method:function(e,t){e!==t&&this.getUrlMeta()}},mounted:function(){this.getUrlMeta()},methods:{getUrlMeta:function(){var e=Object(c["a"])(regeneratorRuntime.mark((function e(){var t;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.$store.dispatch("common/getUrlMeta",{url:this.url});case 2:t=e.sent,this.remoteMeta=t.actions[this.config.method.toUpperCase()]||{},this.onCanSetting()&&this.setFormConfig();case 5:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}(),onCanSetting:function(){var e=Object.keys(this.remoteMeta);return this.canSetting=e.includes(this.method)&&this.$hasPerm("assets.change_platform"),this.$emit("canSetting",this.canSetting),this.canSetting},setFormConfig:function(){var e=[],t={},a=this.method,n=this.remoteMeta[a];e=[[n.label,[a]]],t[a]={fields:[],fieldsMeta:{}};var i=this.pushAccountParams[a];if(Object.keys((null===n||void 0===n?void 0:n.children)||{}).length>0)for(var s=0,c=Object.entries(n.children);s<c.length;s++){var r=Object(o["a"])(c[s],2),u=r[0],p=r[1],h="el-input",f={};switch(null===p||void 0===p?void 0:p.type){case"list":h=l["b"];break;case"boolean":h=l["j"];break;case"text":f["text"]="textarea";break}i&&(p.default=i[u]||p.default);var v=d(d({},p),{},{component:h,el:f});t[a].fields.push(u),t[a].fieldsMeta[u]=v}var m=this.preFieldsMeta[a];if(m)for(var g=0,_=Object.entries(m);g<_.length;g++)for(var b=Object(o["a"])(_[g],2),w=b[0],y=b[1],x=0,k=Object.entries(y);x<k.length;x++){var j=Object(o["a"])(k[x],2),$=j[0],O=j[1];t[a]["fieldsMeta"][w][$]=O}this.config.fields=e,this.config.fieldsMeta=t},onSetting:function(){this.isVisible=!0},onSubmit:function(e){this.$emit("input",e),this.isVisible=!1,this.$emit("update:visible",this.isVisible)},onDialogClose:function(){this.$emit("update:visible",this.isVisible)}}},f=h,v=(a("273b"),a("2877")),m=Object(v["a"])(f,n,i,!1,null,"2772642f",null);t["a"]=m.exports},e4aa:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("GenericDetailPage",e._g(e._b({attrs:{"active-menu":e.config.activeMenu,object:e.role},on:{"update:activeMenu":function(t){return e.$set(e.config,"activeMenu",t)},"update:active-menu":function(t){return e.$set(e.config,"activeMenu",t)},"update:object":function(t){e.role=t}}},"GenericDetailPage",e.config,!1),e.$listeners),[a("keep-alive",[a(e.config.activeMenu,{tag:"component",attrs:{object:e.role}})],1)],1)},i=[],s=(a("7f7f"),a("a481"),a("cd4a")),o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("TwoCol",{scopedSlots:e._u([{key:"right",fn:function(){return[a("IBox",{attrs:{title:e.$tc("Permissions")}},[a("div",{staticStyle:{height:"10%"}},[a("el-button",{staticStyle:{float:"right",width:"100%"},attrs:{disabled:e.isDisabled,size:"small",type:"primary"},on:{click:e.updatePermissions}},[e._v("\n          "+e._s(e.$t("Update"))+"\n        ")])],1),e._v(" "),a("div",{staticClass:"tree-zone"},[a("div",{staticClass:"perm-tree"},[e.loading?e._e():a("AutoDataZTree",{ref:"tree",attrs:{setting:e.setting}})],1)])])]},proxy:!0}])},[[a("AutoDetailCard",{attrs:{fields:e.detailFields,object:e.object,url:e.url}})]],2)},c=[],r=(a("2caf"),a("ac4d"),a("8a81"),a("5df3"),a("1c4c"),a("6b54"),a("87b3"),a("6d67"),a("75fc")),u=(a("d25f"),a("0cd8"),a("57e7"),a("28a5"),a("768b")),l=a("2af9"),p=a("e3bc"),d=a("3e3d"),h=a("52cc");function f(e,t){var a="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!a){if(Array.isArray(e)||(a=v(e))||t&&e&&"number"===typeof e.length){a&&(e=a);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,o=!0,c=!1;return{s:function(){a=a.call(e)},n:function(){var e=a.next();return o=e.done,e},e:function(e){c=!0,s=e},f:function(){try{o||null==a.return||a.return()}finally{if(c)throw s}}}}function v(e,t){if(e){if("string"===typeof e)return m(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?m(e,t):void 0}}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,n=new Array(t);a<t;a++)n[a]=e[a];return n}var g={name:"RolePerms",components:{TwoCol:h["a"],AutoDataZTree:d["a"],AutoDetailCard:p["a"],IBox:l["k"]},props:{object:{type:Object,default:function(){return{}}}},data:function(){var e=this;return{loading:!0,isDisabled:!0,setting:{showAssets:!1,showMenu:!1,showRefresh:!0,showSearch:!1,treeUrl:"",check:{enable:!0},async:{enable:!1},callback:{onCheck:_.debounce((function(t,a,n){e.setUpdateBtn(),e.checkActionDeps(n),e.checkSpecDeps()}),200),beforeCheck:function(e,t){return!0},onClick:_.debounce((function(t,a,n){e.ztree.expandNode(n)}),100)}},nodesDeps:{view_console:[],view_audit:[],view_pam:[],view_workbench:["authentication.view_connectiontoken","authentication.add_connectiontoken","authentication.expire_connectiontoken","authentication.reuse_connectiontoken"],view_setting:["settings.view_setting"],"accounts.view_accountsession":["terminal.view_session"],cloud_import:["assets.view_asset","assets.view_platform"],terminal_node:["settings.change_terminal"],"rbac.orgrolebinding":["rbac.view_orgrole","users.view_user"],"rbac.systemrolebinding":["rbac.view_systemrole","users.view_user"],"tickets.change_ticketflow":["users.view_user","tickets.view_ticket"],"tickets.view_ticket":["assets.match_asset","assets.match_node","assets.match_systemuser","applications.match_application","rbac.view_workbench"],"terminal.view_sessionreplay":["terminal.view_command"],"rbac.view_filemanager":["perms.view_myassets"],"tickets.view_ticketflow":["tickets.view_ticket"],"users.add_user":["rbac.view_role"],"users.change_user":["rbac.view_role"],"users.invite_user":["users.match_user","rbac.add_orgrolebinding","rbac.view_orgrolebinding","rbac.view_orgrole"],"acls.loginacl":["users.view_user"],"acls.loginassetacl":["users.view_user"],"acls.commandfilteracl":["users.view_user"],"assets.view_asset":["assets.view_platform"],"accounts.view_checkaccountexecution":["accounts.view_checkaccountautomation"],"accounts.add_integrationapplication":["accounts.view_account"],"accounts.change_integrationapplication":["accounts.view_account"],"accounts.add_checkaccountexecution":["accounts.view_checkaccountautomation"],"accounts.view_changesecretexecution":["accounts.view_changesecretautomation"],"accounts.add_changesecretexecution":["accounts.view_changesecretautomation"],"accounts.view_changesecretrecord":["accounts.view_changesecretautomation"],"accounts.view_pushaccountexecution":["accounts.view_pushaccountautomation"],"accounts.add_pushaccountexecution":["accounts.view_pushaccountautomation"],"accounts.view_pushsecretrecord":["accounts.view_pushaccountautomation"],"accounts.view_backupaccountexecution":["accounts.view_backupaccountautomation"],"accounts.add_backupaccountexecution":["accounts.view_backupaccountautomation"],"accounts.view_gatheraccountsexecution":["accounts.view_gatheraccountsautomation"],"accounts.add_gatheraccountsexecution":["accounts.view_gatheraccountsautomation"],"accounts.view_gatheraccountsautomation":["accounts.view_gatheredaccount"],"assets.view_node":["assets.view_asset","assets.view_platform"],"acls.commandgroup":["acls.view_commandfilteracl"],"assets.gateway":["assets.view_zone"],"assets.add_gateway":["assets.view_zone","assets.view_platform","assets.view_node"],"assets.change_gateway":["assets.view_zone","assets.view_platform","assets.view_node"],"assets.add_asset":["assets.view_platform"],"assets.change_asset":["assets.view_platform"],"accounts.view_gatheredaccount":["assets.view_asset","assets.view_node"],"accounts.view_accounttemplate":["accounts.view_account"],"accounts.view_account":["assets.view_node"],"accounts.view_accountsecret":["accounts.view_account"],"accounts.view_historyaccount":["accounts.view_account","accounts.view_accountsecret"],"accounts.view_accounttemplatesecret":["accounts.view_accounttemplate"],"accounts.view_historyaccountsecret":["accounts.view_account","accounts.view_accountsecret"],"accounts.add_account":["assets.view_asset"],"assets.gathereduser":["assets.view_node"],"assets.refresh_assethardwareinfo":["assets.change_asset"],"xpack.gatherusertaskexecution":["xpack.view_gatherusertask"],"applications.add_application":["assets.view_asset"],"applications.view_account":["applications.view_application"],"perms.view_assetpermission":["assets.view_node"],"perms.view_applicationpermission":["applications.view_application"],"perms.assetpermission":["assets.view_asset","assets.view_node","assets.view_systemuser","users.view_user","users.view_usergroup"],"perms.applicationpermission":["applications.view_application","assets.view_systemuser","users.view_user","users.view_usergroup"],"settings.change_systemmsgsubscription":["users.view_user"],"terminal.add_terminal":["terminal.view_commandstorage","terminal.view_replaystorage"],"terminal.change_terminal":["terminal.view_commandstorage","terminal.view_replaystorage"],"terminal.view_commandstroage":["settings.change_terminal"],"terminal.view_replaystorage":["settings.change_terminal"],"terminal.view_status":["settings.change_terminal"],"terminal.view_task":["settings.change_terminal"],"terminal.view_terminal":["settings.change_terminal"],"terminal.add_applethost":["assets.view_platform"],"terminal.change_applethost":["assets.view_platform"],"ops.view_job":["assets.view_asset","assets.view_node","ops.view_adhoc","ops.view_playbook"],"ops.change_job":["assets.view_asset","assets.view_node","ops.view_adhoc","ops.view_playbook"],"ops.add_job":["assets.view_asset","assets.view_node","ops.view_adhoc","ops.view_playbook"],"ops.add_jobexecution":["ops.view_celerytaskexecution"],"authentication.add_connectiontoken":["rbac.view_webterminal"],"labels.view_labeledresource":["rbac.view_contenttype"],"xpack.add_syncinstancetask":["assets.view_asset","assets.view_node","assets.view_systemuser","xpack.view_account"],"xpack.view_syncinstancetask":["xpack.view_account"],"xpack.view_syncinstancedetail":["xpack.view_syncinstancetask"],"xpack.view_syncinstancetaskexecution":["xpack.view_syncinstancetask"],"xpack.view_changeauthplan":["assets.view_asset"],"xpack.view_changeauthplantask":["xpack.view_changeauthplan"],"xpack.view_changeauthplanexecution":["xpack.view_changeauthplan"],"xpack.view_applicationchangeauthplan":["applications.view_application","assets.view_systemuser"],"xpack.view_applicationchangeauthplantask":["xpack.view_applicationchangeauthplan"],"xpack.view_applicationchangeauthplanexecution":["xpack.view_applicationchangeauthplan"]},url:"/api/v1/rbac/".concat(this.object.scope.value,"-roles/").concat(this.object.id),detailFields:["display_name","scope_display","builtin","created_by","date_created","date_updated","comment"]}},computed:{ztree:function(){return this.$refs.tree.zTree},scope:function(){return this.object.scope.value}},mounted:function(){this.setting.treeUrl="/api/v1/rbac/".concat(this.object.scope.value,"-roles/").concat(this.object.id,"/permissions/tree/")},activated:function(){var e=this;this.loading=!0,setTimeout((function(){e.loading=!1}))},methods:{setUpdateBtn:function(){var e="rbac.change_".concat(this.object.scope.value,"role");this.$hasPerm(e)&&(this.isDisabled=!1)},parsePerm:function(e){if(e){var t=e.split("."),a=Object(u["a"])(t,2),n=a[0],i=a[1];if(n&&i){var s=i.split("_"),o=Object(u["a"])(s,2),c=o[0],r=o[1];if(c&&r)return{action:c,resource:r,app:n}}else this.$log.debug("App or code not found")}else this.$log.debug("No app code: ",e)},checkActionDeps:function(e){if(e.isParent)this.$log.debug("Is parent");else{var t=this.parsePerm(e.title);if(t){var a=t.app,n=t.action,i=t.resource,s=this.$refs.tree.zTree,o="".concat(a,".view_").concat(i),c=s.getNodeByParam("title",o);if(c){var r=["match"],u=e.checked;if("view"===n){if(u)return;var l,p=c.getParentNode(),d=p.children,h=f(d);try{for(h.s();!(l=h.n()).done;){var v=l.value,m=this.parsePerm(v.title);if(m){var g=m.action,_=m.resource;this.$log.debug("Action: ",g,m),"view"===g||r.indexOf(g)>-1||_!==i||s.checkNode(v,!1)}}}catch(b){h.e(b)}finally{h.f()}}else if(r.indexOf(n)>-1)this.$log.debug("Action is ignore: ",n);else{if(!u)return;this.$log.debug("Select view node: ",c),s.checkNode(c,!0)}}}else this.$log.error("Parse perm error: ",e.title)}},checkSpecDeps:function(){var e=this,t=this.$refs.tree.zTree,a=t.getCheckedNodes().filter((function(t){return!!e.nodesDeps[t.title]})).reduce((function(t,a){return[].concat(Object(r["a"])(t),Object(r["a"])(e.nodesDeps[a.title]))}),[]);this.$log.debug("Select nodes should try: ",a);var n,i=f(a);try{for(i.s();!(n=i.n()).done;){var s=n.value,o=this.ztree.getNodeByParam("title",s);o?this.ztree.checkNode(o,!0):this.$log.debug("Not found depNode for title: ".concat(s))}}catch(c){i.e(c)}finally{i.f()}},updatePermissions:function(){var e=this,t=this.$refs.tree.zTree,a=t.getCheckedNodes(),n=a.filter((function(e){return!e.isParent})),i=n.map((function(e){return e.id})),s="/api/v1/rbac/".concat(this.object.scope.value,"-roles/").concat(this.object.id,"/"),o={permissions:i};this.$axios.patch(s,o).then((function(){e.$message.success(e.$tc("UpdateSuccessMsg"))})).catch((function(t){e.$message.error(e.$tc("UpdateErrorMsg")+t),e.$log.error(t)}))}}},b=g,w=(a("d08e"),a("2877")),y=Object(w["a"])(b,o,c,!1,null,"ad80852a",null),x=y.exports,k=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("TwoCol",{scopedSlots:e._u([{key:"right",fn:function(){return[e.loading?e._e():a("RelationCard",e._b({ref:"userRelation"},"RelationCard",e.relationConfig,!1))]},proxy:!0}])},[[a("ListTable",{ref:"ListTable",attrs:{"header-actions":e.headerActions,"table-config":e.tableConfig}})]],2)},j=[],$=(a("1c01"),a("58b2"),a("8e6e"),a("f3e2"),a("ac6a"),a("456d"),a("bd86")),O=(a("d92a"),a("2f62")),P=a("53f7");function S(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function D(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?S(Object(a),!0).forEach((function(t){Object($["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):S(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var C={components:{TwoCol:h["a"],ListTable:l["m"],RelationCard:l["p"]},props:{object:{type:Object,required:!0}},data:function(){var e=this;return{loading:!0,relationConfig:{disabled:!this.$hasPerm("rbac.add_".concat(this.object.scope.value,"rolebinding")),icon:"fa-user",title:this.$t("Members"),objectsAjax:{url:"/api/v1/users/users/?fields_size=mini&order=name".concat("system"===this.object.scope.value?"&oid=root":""),transformOption:function(e){return{label:e.name+"("+e.username+")",value:e.id}}},performAdd:function(t){var a="/api/v1/rbac/".concat(e.object.scope.value,"-role-bindings/"),n=e.object.id,i=t.map((function(t){return{user:t.value,role:n,scope:e.object.scope.value}}));return e.$axios.post(a,i)},onAddSuccess:function(){e.$message.success(e.$tc("UpdateSuccessMsg")),e.$refs.ListTable.reloadTable(),e.$refs.userRelation.$refs.select2.clearSelected()}},tableConfig:{url:"/api/v1/rbac/".concat(this.object.scope.value,"-role-bindings/?role=").concat(this.object.id),columns:"system"===this.object.scope.value?["user_display","delete_action"]:["user_display","org_name","delete_action"],columnsShow:{min:["user_display","delete_action"]},columnsMeta:{user_display:{label:this.$t("Name"),formatter:function(e){return"".concat(e.user.name,"(").concat(e.user.username,")")}},delete_action:{prop:"id",label:this.$t("Actions"),align:"center",width:150,objects:"all",formatter:P["h"],formatterArgs:{disabled:!1},onDelete:function(e,t,a,n){var i=this;this.$axios.delete("/api/v1/rbac/".concat(this.object.scope.value,"-role-bindings/").concat(t.id,"/?role=").concat(this.object.id)).then((function(e){i.$message.success(i.$tc("DeleteSuccessMsg")),n()})).catch((function(e){i.$message.error({message:e.response.data.detail,duration:3e3})}))}.bind(this)},actions:{has:!1,formatterArgs:{hasUpdate:!1,hasClone:!1,canDelete:function(t){var a=t.row;return e.$hasPerm("rbac.delete_".concat(a.scope,"rolebinding"))}}}}},headerActions:{hasLeftActions:!1,importOptions:{canImportUpdate:!1},searchConfig:{exclude:["user","scope","role","org"],options:[{label:this.$t("Username"),value:"user__username"},{label:this.$t("User"),value:"user__name"}]}}}},computed:D({},Object(O["b"])(["currentOrg","currentOrgIsRoot"])),created:function(){try{var e=this.$route.query["scope"];this.relationConfig.disabled=!this.$hasPerm("rbac.add_".concat(this.object.scope.value,"rolebinding"))||"org"===e&&this.currentOrgIsRoot}finally{this.loading=!1}}},A=C,R=Object(w["a"])(A,k,j,!1,null,null,null),M=R.exports,T={components:{GenericDetailPage:s["d"],RoleInfo:x,RoleUsers:M},data:function(){var e=this,t=this,a=this.$route.query["scope"],n="".concat(a,"role");return{scope:a,scopeRole:a+"role",role:{name:"",comment:"",users:[]},config:{titlePrefix:"org"===a?t.$t("OrgRole"):t.$t("SystemRole"),getObjectName:function(e){return e.display_name},url:"/api/v1/rbac/".concat(a,"-roles"),activeMenu:"RoleInfo",actions:{canDelete:function(){return t.hasPermNotBuiltin(e.role,"rbac.delete_".concat(n))},canUpdate:function(){return t.hasPermNotBuiltin(e.role,"rbac.change_".concat(n))},updateRoute:{name:this.$route.name.replace("Detail","Update"),params:{},query:{scope:a}}},submenu:[{title:this.$t("Basic"),name:"RoleInfo"},{title:this.$t("RoleUsers"),name:"RoleUsers",hidden:function(){return!e.$hasPerm("rbac.view_".concat(a,"rolebinding"))}}]}}},methods:{hasPermNotBuiltin:function(e,t){return!e["builtin"]&&this.$hasPerm(t)}}},E=T,U=Object(w["a"])(E,n,i,!1,null,null,null);t["default"]=U.exports}}]);